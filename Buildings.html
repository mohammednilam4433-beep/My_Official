<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üè† Building Approval - Draftsman Booking</title>
  <style>
    body, html {
      margin:0; 
      padding:0; 
      font-family: Arial, sans-serif;
    }

    /* Navbar */
    nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #2c3e50;
      padding: 12px 20px;
      color: white;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    /* Right section */
    .nav-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .nav-right input {
      padding: 6px 10px;
      border: none;
      border-radius: 5px;
      font-size: 14px;
      outline: none;
    }

    .nav-right button {
      background: #ff6600;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      color: white;
      font-size: 14px;
      transition: 0.3s;
    }

    .nav-right button:hover {
      background: #e65c00;
    }

    /* Page content overlay */
    body {
      background:url('https://images.unsplash.com/photo-1448630360428-65456885c650?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1347&q=80') center/cover no-repeat;
      overflow-y:auto;
	  color: lighter;
    }

    .overlay {
      background:rgba(255,255,255,0.95);
      padding:40px;
      margin:80px auto 20px;
      max-width:1000px;
      border-radius:12px;
      box-shadow: 0 5px 25px rgba(0,0,0,0.2);
    }
    
    h1 {text-align:right; margin-top:0; font-size:32px;}
    h2 {margin-top:24px; font-size:20px; color:#00695c;}
    p {line-height:1.6;}

    /* Form */
    form {display:grid; gap:12px; margin-top:12px;}
    form input, form textarea, form select {padding:10px; border:1px solid #ccc; border-radius:8px;}
    form button {padding:12px; background:#00695c; color:white; border:none; border-radius:8px; cursor:pointer;}
    form button:hover {background:#004d40;}

    /* Contact Section */
    .contact-section {
      margin: 40px 0;
      padding: 20px;
      background-color: #f5f5f5;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .contact-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .contact-card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      text-align: center;
    }
    
    .contact-card h3 {
      color: #004d99;
      margin-top: 0;
    }
    
    .contact-icon {
      font-size: 24px;
      margin-bottom: 10px;
      color: #ff6600;
    }

    /* Booking Form Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }
    
    .modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 800px;
      border-radius: 10px;
      position: relative;
    }
    
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .close:hover {
      color: black;
    }
    
    .booking-form-container {
      max-width: 800px;
      margin: 20px auto;
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
    }
    
    .booking-form-container h2 {
      text-align: center;
      color: #333;
    }
    
    .booking-form-container label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: #444;
    }
    
    .booking-form-container input, 
    .booking-form-container select, 
    .booking-form-container textarea {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }
    
    .booking-form-container textarea {
      resize: vertical;
    }
    
    .submit-btn {
      width: 100%;
      background: #007bff;
      color: #fff;
      padding: 12px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      margin-top: 20px;
      cursor: pointer;
      transition: 0.3s;
    }
    
    .submit-btn:hover {
      background: #0056b3;
    }
    
    .error {
      color: red;
      font-size: 13px;
    }
    
    /* Booking Button */
    .booking-btn {
      display: block;
      width: 200px;
      margin: 30px auto;
      padding: 12px 20px;
      background: #ff6600;
      color: white;
      text-align: center;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    
    .booking-btn:hover {
      background: #e65c00;
      transform: scale(1.05);
    }
    
    /* Footer */
    footer {
      text-align: center;
      padding: 20px;
      margin-top: 40px;
      background: #004d99;
      color: white;
      border-radius: 0 0 10px 10px;
    }
    
    .footer-content {
      max-width: 1000px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .footer-nav {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 15px;
    }
    
    .footer-nav a {
      color: white;
      text-decoration: none;
    }
    
    .footer-nav a:hover {
      text-decoration: underline;
    }
    
    /* Draftsman Selection */
    .draftsman-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .draftsman-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .draftsman-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .draftsman-card.selected {
      border-color: #007bff;
      background-color: #f0f8ff;
    }
    
    .draftsman-card h3 {
      margin-top: 0;
      color: #004d99;
    }
    
    .availability-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    
    .availability-table th, 
    .availability-table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    
    .availability-table th {
      background-color: #f2f2f2;
    }
    
    .available {
      background-color: #d4edda;
    }
    
    .not-available {
      background-color: #f8d7da;
    }
    
    .step-indicator {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    
    .step {
      flex: 1;
      text-align: center;
      padding: 10px;
      background-color: #e9ecef;
      border-radius: 5px;
      margin: 0 5px;
    }
    
    .step.active {
      background-color: #007bff;
      color: white;
    }
    
    .form-step {
      display: none;
    }
    
    .form-step.active {
      display: block;
    }
    
    .navigation-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    
    .nav-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    
    .prev-btn {
      background-color: #6c757d;
      color: white;
    }
    
    .next-btn {
      background-color: #007bff;
      color: white;
    }

    .success-message {
      display: none;
      background: #d4edda;
      color: #155724;
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
      text-align: center;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }

    .loading-spinner {
      border: 5px solid #f3f3f3;
      border-top: 5px solid #007bff;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Office Contact Information */
    .office-contact {
      margin: 20px 0;
      padding: 15px;
      background-color: #e8f4fd;
      border-radius: 8px;
      border-left: 4px solid #007bff;
    }
    
    .office-contact h3 {
      margin-top: 0;
      color: #004d99;
    }
    
    .office-contact p {
      margin: 8px 0;
    }
    
    .contact-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .contact-info-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .contact-info-icon {
      font-size: 20px;
      color: #007bff;
    }
  </style>
</head>
<body>

  <!-- Navigation Bar -->
  <nav>
    <h1>üèóÔ∏è Building Approval</h1>
    <div class="nav-right">
      <button onclick="goBack()">Back</button>
      <input type="text" id="searchBox" placeholder="Search...">
    </div> 
  </nav>

  <div class="overlay">
    <section id="regulations">
      <h2>Documents to be Submitted for Building Approval</h2>
      <ul>
        <li>Completed application form (the application form and plan should be submitted in triplicate).</li><br>
        <li>Certified copy of the deed of ownership (a certified copy should be submitted after the original is certified).</li><br>
        <li>Certified copy of the survey plan (a certified copy should be submitted after the original is certified).</li><br>
        <li>Copy of the document verifying the applicant's name and address.</li><br>
        <li>Copy of the applicant's land-use certificate and the consent of the other landowner if a part of the land belongs to someone else (should be certified by the Grama Sevaka).</li><br>
        <li>The consent letter of the adjoining landowner (should be certified by the Grama Sevaka).</li><br>
        <li>A plan of the proposed building and a copy of the land survey report in triplicate (signed by a qualified building planner/engineer, and showing the location of the building, address, telephone number, and email).</li><br>
        <li>Building plan approval report.</li><br>
        <li>Copy of the applicant's national identity card.</li><br>
        <li>Water and electricity report (if required).</li><br>
        <li>Other necessary documents requested by the engineer or officer.</li><br>
      </ul>
      
      <h2>Other Departmental Approvals to be Obtained as Required by Local Authorities.</h2>
      <ul>
        <li>Permission should be obtained from the Medical Officer of Health.</li><br>
        <li>Permission should be obtained from the Fire Authority (if required).</li><br>
        <li>Recommendation from the Central Environmental Authority (if required).</li><br>
        <li>Recommendation from the Department of Archaeology (if required).</li><br>
        <li>Recommendation from the Department of Agrarian Services (if required).</li><br>
        <li>Recommendation from the Railways Department (if required).</li><br>
        <li>Recommendation from the Irrigation Department (if required).</li><br>
        <li>Report from the Road Development Authority (if required).</li><br>
        <li>If all of the above-mentioned requirements are fulfilled, approval for the building application will be granted within three working days.</li><br>
      </ul>
    </section>
    
    <!-- Office Contact Information Section -->
    <section class="contact-section">
      <h2>Find Local Office Contact Information</h2>
      <p>Select your district and pradeshiya sabha to view the local office contact details.</p>
      
      <div class="office-contact-selector">
        <label for="districtContact">Select District:</label>
        <select id="districtContact" name="districtContact" onchange="loadPradeshiyaSabhasContact()">
          <option value="">-- Select District --</option>
          <!-- Options will be loaded from database -->
        </select>
        
        <label for="pradeshiyaSabhaContact">Select Pradeshiya Sabha:</label>
        <select id="pradeshiyaSabhaContact" name="pradeshiyaSabhaContact" onchange="showOfficeContact()">
          <option value="">-- Select Pradeshiya Sabha --</option>
          <!-- Options will be loaded dynamically -->
        </select>
      </div>
      
      <div id="officeContactInfo" class="office-contact" style="display: none;">
        <h3>Office Contact Information</h3>
        <div class="contact-info-grid">
          <div class="contact-info-item">
            <span class="contact-info-icon">üìû</span>
            <div>
              <strong>Phone:</strong>
              <p id="officePhone"></p>
            </div>
          </div>
          <div class="contact-info-item">
            <span class="contact-info-icon">üìß</span>
            <div>
              <strong>Email:</strong>
              <p id="officeEmail"></p>
            </div>
          </div>
          <div class="contact-info-item">
            <span class="contact-info-icon">üïí</span>
            <div>
              <strong>Working Hours:</strong>
              <p id="officeHours"></p>
            </div>
          </div>
          <div class="contact-info-item">
            <span class="contact-info-icon">üìç</span>
            <div>
              <strong>Address:</strong>
              <p id="officeAddress"></p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

    <!-- Draftsman Booking Button -->
    <div class="booking-btn" id="openBookingForm">
      Draftsman Booking Form
    </div>

    <!-- Success Message -->
    <div class="success-message" id="successMessage">
      <h3>‚úÖ Booking Submitted Successfully!</h3>
      <p>Your booking request has been sent to the draftsman. You will receive a confirmation email shortly.</p>
    </div>

    <!-- Loading Indicator -->
    <div class="loading" id="loadingIndicator">
      <div class="loading-spinner"></div>
      <p>Processing your request...</p>
    </div>

    <!-- Draftsman Booking Form Modal -->
    <div id="bookingModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div class="booking-form-container">
          <h2>Draftsman Online Booking Form</h2>
          
          <div class="step-indicator">
            <div class="step active" id="step1-indicator">1. Personal Details</div>
            <div class="step" id="step2-indicator">2. Location</div>
            <div class="step" id="step3-indicator">3. Draftsman Selection</div>
            <div class="step" id="step4-indicator">4. Confirmation</div>
          </div>
          
          <form id="bookingForm">
            <!-- Step 1: Personal Details -->
            <div class="form-step active" id="step1">
              <label>Full Name *</label>
              <input type="text" id="name" name="name" required>
              <div id="nameError" class="error"></div>

              <label>Contact Number *</label>
              <input type="tel" id="phone" name="phone" required>
              <div id="phoneError" class="error"></div>

              <label>Email Address *</label>
              <input type="email" id="email" name="email" required>
              <div id="emailError" class="error"></div>

              <label>NIC Number *</label>
              <input type="text" id="nic" name="nic" required>
              <div id="nicError" class="error"></div>

              <label>Project Details *</label>
              <textarea id="projectDetails" name="projectDetails" rows="4" required></textarea>
              
              <div class="navigation-buttons">
                <div></div> <!-- Empty div for spacing -->
                <button type="button" class="nav-btn next-btn" onclick="nextStep(1)">Next</button>
              </div>
            </div>
            
            <!-- Step 2: Location Selection -->
            <div class="form-step" id="step2">
              <label>Select District *</label>
              <select id="district" name="district" required onchange="loadPradeshiyaSabhas()">
                <option value="">-- Select District --</option>
                <!-- Options will be loaded from database -->
              </select>
              
              <label>Select Pradeshiya Sabha *</label>
              <select id="pradeshiyaSabha" name="pradeshiyaSabha" required onchange="loadDraftsmenFromLocalStorage()">
                <option value="">-- Select Pradeshiya Sabha --</option>
                <!-- Options will be loaded dynamically -->
              </select>
              
              <div class="navigation-buttons">
                <button type="button" class="nav-btn prev-btn" onclick="prevStep(2)">Previous</button>
                <button type="button" class="nav-btn next-btn" onclick="nextStep(2)">Next</button>
              </div>
            </div>
            
            <!-- Step 3: Draftsman Selection -->
            <div class="form-step" id="step3">
              <div id="draftsmanSelection">
                <p>Please select a district and pradeshiya sabha to view available draftsmen.</p>
              </div>
              
              <div class="navigation-buttons">
                <button type="button" class="nav-btn prev-btn" onclick="prevStep(3)">Previous</button>
                <button type="button" class="nav-btn next-btn" onclick="nextStep(3)">Next</button>
              </div>
            </div>
            
            <!-- Step 4: Confirmation -->
            <div class="form-step" id="step4">
              <h3>Please review your information:</h3>
              <div id="reviewDetails"></div>
              
              <label>
                <input type="checkbox" id="confirm" required>
                I confirm that the above details are correct and I agree to the terms of service.
              </label>
              
              <div class="navigation-buttons">
                <button type="button" class="nav-btn prev-btn" onclick="prevStep(4)">Previous</button>
                <button type="submit" class="submit-btn">Submit Booking</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Contact Section -->
    <section class="contact-section">
      <h2>Head Office Contact Information</h2>
      <div class="contact-grid">
        <div class="contact-card">
          <div class="contact-icon">üìû</div>
          <h3>Phone</h3>
          <p>+94 021 228 4572</p>
          <p>+94 021 228 4573</p>
        </div>
        
        <div class="contact-card">
          <div class="contact-icon">üìß</div>
          <h3>Email</h3>
          <p>buildingoffice@example.com</p>
          <p>support@buildingoffice.com</p>
        </div>
        
        <div class="contact-card">
          <div class="contact-icon">üìç</div>
          <h3>Location</h3>
          <p>123 Main Street</p>
          <p>Colombo, Sri Lanka</p>
        </div>
        
        <div class="contact-card">
          <div class="contact-icon">üïí</div>
          <h3>Working Hours</h3>
          <p>Monday-Friday: 8:30 AM - 4:30 PM</p>
          <p>Saturday: 9:00 AM - 1:00 PM</p>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer>
      <div class="footer-content">
        <div class="footer-nav">
          <a href="index.html">Home</a>
          <a href="#">About Us</a>
          <a href="#">Services</a>
          <a href="#">Contact</a>
          <a href="#">Privacy Policy</a>
        </div>
        <p>&copy; 2025 Building Approval Home | Designed for Sri Lanka Building Regulations</p>
      </div>
    </footer>
  </div>

  <script>
    // Database simulation (in a real application, this would be server-side)
    const districtsData = [
      "Ampara", "Anuradhapura", "Badulla", "Batticaloa", "Colombo", 
      "Galle", "Gampaha", "Hambantota", "Jaffna", "Kalutara",
      "Kandy", "Kegalle", "Kilinochchi", "Kurunegala", "Mannar",
      "Matale", "Matara", "Monaragala", "Mullaitivu", "Nuwara Eliya",
      "Polonnaruwa", "Puttalam", "Ratnapura", "Trincomalee", "Vavuniya"
    ];

    const pradeshiyaSabhasData = {
      "Kilinochchi": ["Poonakary", "Karachchi","Pachchilaippalli"],
      "Jaffna": ["Jaffna","Kayts","Delft","Karainagar","Chavakachcheri","Point Pedro","Nallur", "Valikamam East","Valikamam North","Valikamam West","Valikamam South","Valikamam South West","Thenmaradchi", "Vadamaradchi South West","Velanai"],
      "Colombo": ["Homagama","Kotikawatta Mulleriyawa","Seethawaka"],
      "Gampaha": ["Attanagalla","Biyagama","Divulapitiya","Dompe","Gampaha","Ja-ela","Katana","Kelaniya","Mahara","Meerigama","Minuwangoda","Wattala"],
      "Kandy": ["Akurana","Ganga lhala","Harispattuwa","Kandy Gravets & Gangawata Korale","Kundasale","Meda Dumbara","Minipe","Panwila","Pasbage Korale","Patadumbara","Patahewahta","Pujapitiya","Thumpane","Uda Palatha","Ududumbara","Udunuwara","Yatinuwara","Delthota","Doluwa","Hatharaliyadda"],
      "Ampara": ["Dehiyattakandiya", "Damana", "Uhana","Mahaoya","Namaloya","Padiyatalawa","Sammanthurai","Akkaraipattu","Ampara","Potuvil","Addalachchnai","Alayadivembu","Lahugala","Nindavur","Thirukkovil","Karaithivu","Navithanveli","Irrakkaram"],
      "Anuradhapura": ["Galenbindunuwewa","Galnewa","Horowpathana","Ipalogama","Kahatagasdigiliya","Kebathigollawa","Kekirawa","Medawachchiya","Mihintale","Nochchiyagama","Nuwaragam Palatha (East)","Nuwaragam Palatha (Central)","Padaviya","Palagala","Rajanganaya","Rambewa","Thalawa","Thirappane"],
      "Badulla": ["Badulla","Bandarawela","Ella","Haldummulla","Hali-Ela","Haputale","Kandeketiya","Lunugala","Mahiyanganaya","Meegahakiula","Passara","Rideemaliyadda","Soranatota","Uva Paranagama","Welimada"],
      "Batticaloa": ["Eravurpattu","Koralaipattu","Koralaipattu West","Koralaipattu North","Manmunai South Eravurpattu","Manmunai","Manmunai West","Manmunai South West","Porativupattu"],
      "Galle": ["Akmeemana","Ambalangoda","Baddegama","Balapitiya","Bentota","Bope-Poddala","Elpitiya","Habaraduwa","Imaduwa","Karandeniya","Nagoda","Neluwa","Niyagama","Raggama","Thawalama","Welivitiya-Divithura","Yakkalamulla"],
      "Monaragala": ["Badalkumbara","Bibila","Buttala","Kataragama","Madulla","Medagama","Moneragala","Siyambalanduwa","Thanamalwila","Wellawaya"],
      "Hambantota": ["Ambalantota","Angunakolapelassa","Beliatta","Hambantota","Katuwana","Lunugamvehera","Sooriyawewa","Tangalle","Tissamaharama","Weeraketiya"],
      "Kalutara": ["Agalawatta","Bandaragama","Beruwela","Bulathsinhala","Dodangoda","Horana","Kalutara","Madurawela","Matugama","Palindanuwara","Panadura","Walallawita"],
      "Kegalle": ["Aranayake","Bulathkohupitiya","Dehiowita","Deraniyagala","Galigamuwa","Kegalle","Mawanella","Rambukkana","Ruwanwella","Warakapola","Yatiyantota"],
      "Kurunegala": ["Alawwa","Bingiriya","Galgamuwa","Giribawa","lbbagamuwa","Kpbeiagane","Kuliyapitiya","Kurunegala","Mahawa","Mawathagama","Narammala","Nikaweratiya","Panduwasnuwara","Pannala","Polgahawela","Polpithigama","Ridigama","Udubaddawa","Wariyapola"],
      "Mannar": ["Mannar","Manthai West","Musali","Nanaddan"],
      "Matale": ["Ambanganga Korale","Dambulla","Galewala","Laggala-Pallegama","Matale","Naula","Pallepola","Rattota","Ukuwela","Wilgamuwa","Yatawatta","Yatawatta"],
      "Matara": ["Akuressa","Athuraliya","Devinuwara","Dickwella","Hakmana","Kamburupitiya","Kirinda-Puhulwella","Kotapola","Malimbada","Matara","Mulatiyana","Pasgoda","Pitabeddara","Thihagoda","Weligama"],
      "Mullaitivu": ["Manthai East","Maritimepattu","Puthukudiyiruppu","Thunukkai"],
      "Nuwara Eliya": ["Ambagamuwa","Hanguranketha","Kothmale","Nuwara Eliya","Walapane"],
      "Polonnaruwa": ["Dimbulagala","Elahera","Hingurakgoda","Lankapura","Medirigiriya","Polonnaruwa","Welikanda"],
      "Puttalam": ["Anamaduwa","Arachchikattuwa","Chilaw","Kalpitiya","Karuwalagaswewa","Nattandiya","Nawagattegama","Puttalam","Wanathawilluwa","Wennappuwa"],
      "Ratnapura": ["Ayagama","Balangoda","Ehaliyagoda","Embilipitiya","Godakawela","Imbulpe","Kahawatta","Kalawana","Kolonna","Kuruwita","Nivithigala","Pelmadulla","Rathnapura","Weligepola"],
      "Trincomalee": ["Trincomalee Town & Gravets", "Kuchchaveli", "Thampalakamam","Muttur","Kinniya","Verugal","Seruvila","Kantalai","Morawewa","Gomarankadawala","Padavisripura"],
      "Vavuniya": ["Vavuniya North","Vavuniya South Tamil","Vavuniya South Sinhala","Vengalacheddikulam"],
    };

    // Office contact information data
    const officeContactData = {
      "Poonakary": {
        phone: "+94 021 123 4567",
        email: "poonakary.office@building.gov.lk",
        hours: "Monday-Friday: 8:30 AM - 4:30 PM",
        address: "123 Main Street, Poonakary, Kilinochchi"
      },
      "Karachchi": {
        phone: "+94 021 123 4568",
        email: "karachchi.office@building.gov.lk",
        hours: "Monday-Friday: 8:30 AM - 4:30 PM, Saturday: 9:00 AM - 1:00 PM",
        address: "456 Central Road, Karachchi, Kilinochchi"
      },
      "Jaffna": {
        phone: "+94 021 123 4569",
        email: "jaffna.office@building.gov.lk",
        hours: "Monday-Friday: 8:30 AM - 4:30 PM",
        address: "789 Temple Road, Jaffna"
      },
      "Colombo": {
        phone: "+94 011 123 4567",
        email: "colombo.office@building.gov.lk",
        hours: "Monday-Friday: 8:30 AM - 4:30 PM, Saturday: 9:00 AM - 1:00 PM",
        address: "123 Galle Road, Colombo 03"
      },
      "Gampaha": {
        phone: "+94 033 123 4567",
        email: "gampaha.office@building.gov.lk",
        hours: "Monday-Friday: 8:30 AM - 4:30 PM",
        address: "45 Negombo Road, Gampaha"
      },
      "Kandy": {
        phone: "+94 081 123 4567",
        email: "kandy.office@building.gov.lk",
        hours: "Monday-Friday: 8:30 AM - 4:30 PM, Saturday: 9:00 AM - 1:00 PM",
        address: "78 Temple Street, Kandy"
      },
    };

    let selectedDraftsman = null;
    let currentStep = 1;

    function goBack() {
      window.history.back();
    }

    // Search action
    document.getElementById("searchBox").addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        alert("You searched for: " + this.value);
      }
    });
    
    // Modal functionality
    const modal = document.getElementById("bookingModal");
    const btn = document.getElementById("openBookingForm");
    const span = document.getElementsByClassName("close")[0];
    
    btn.onclick = function() {
      modal.style.display = "block";
      resetForm();
      loadDistricts(); // Load districts when modal opens
    }
    
    span.onclick = function() {
      modal.style.display = "none";
    }
    
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
    
    function resetForm() {
      currentStep = 1;
      selectedDraftsman = null;
      updateStepIndicator();
      document.getElementById("bookingForm").reset();
      document.getElementById("pradeshiyaSabha").innerHTML = '<option value="">-- Select Pradeshiya Sabha --</option>';
      document.getElementById("draftsmanSelection").innerHTML = '<p>Please select a district and pradeshiya sabha to view available draftsmen.</p>';
    }
    
    function updateStepIndicator() {
      // Update step indicators
      for (let i = 1; i <= 4; i++) {
        const indicator = document.getElementById(`step${i}-indicator`);
        const step = document.getElementById(`step${i}`);
        
        if (i === currentStep) {
          indicator.classList.add("active");
          step.classList.add("active");
        } else {
          indicator.classList.remove("active");
          step.classList.remove("active");
        }
      }
    }
    
    function nextStep(step) {
      // Validate current step before proceeding
      if (step === 1 && !validateStep1()) return;
      if (step === 2 && !validateStep2()) return;
      if (step === 3 && !validateStep3()) return;
      
      currentStep = step + 1;
      
      // If moving to step 3, load draftsmen
      if (currentStep === 3) {
        loadDraftsmenFromLocalStorage();
      }
      
      // If moving to step 4, show review
      if (currentStep === 4) {
        showReview();
      }
      
      updateStepIndicator();
    }
    
    function prevStep(step) {
      currentStep = step - 1;
      updateStepIndicator();
    }
    
    function validateStep1() {
      let valid = true;

      // Name validation
      const name = document.getElementById("name").value.trim();
      if(name.length < 3){
        document.getElementById("nameError").innerText = "Name must be at least 3 characters.";
        valid = false;
      } else {
        document.getElementById("nameError").innerText = "";
      }

      // Phone validation
      const phone = document.getElementById("phone").value.trim();
      const phonePattern = /^[0-9]{10}$/;
      if(!phonePattern.test(phone)){
        document.getElementById("phoneError").innerText = "Enter a valid 10-digit number.";
        valid = false;
      } else {
        document.getElementById("phoneError").innerText = "";
      }

      // Email validation
      const email = document.getElementById("email").value.trim();
      const emailPattern = /^[^ ]+@[^ ]+\.[a-z]{2,3}$/;
      if(!emailPattern.test(email)){
        document.getElementById("emailError").innerText = "Enter a valid email address.";
        valid = false;
      } else {
        document.getElementById("emailError").innerText = "";
      }
      
      // NIC validation
      const nic = document.getElementById("nic").value.trim();
      const nicPattern = /^[0-9]{9}[vVxX]?$|^[0-9]{12}$/;
      if(!nicPattern.test(nic)){
        document.getElementById("nicError").innerText = "Enter a valid NIC number.";
        valid = false;
      } else {
        document.getElementById("nicError").innerText = "";
      }

      return valid;
    }
    
    function validateStep2() {
      const district = document.getElementById("district").value;
      const pradeshiyaSabha = document.getElementById("pradeshiyaSabha").value;
      
      if (!district) {
        alert("Please select a district.");
        return false;
      }
      
      if (!pradeshiyaSabha) {
        alert("Please select a pradeshiya sabha.");
        return false;
      }
      
      return true;
    }
    
    function validateStep3() {
      if (!selectedDraftsman) {
        alert("Please select a draftsman.");
        return false;
      }
      
      return true;
    }
    
    function loadDistricts() {
      const districtSelect = document.getElementById("district");
      
      // Clear previous options
      districtSelect.innerHTML = '<option value="">-- Select District --</option>';
      
      // Add all 25 districts
      districtsData.forEach(district => {
        const option = document.createElement("option");
        option.value = district;
        option.textContent = district;
        districtSelect.appendChild(option);
      });
    }
    
    function loadPradeshiyaSabhas() {
      const district = document.getElementById("district").value;
      const pradeshiyaSabhaSelect = document.getElementById("pradeshiyaSabha");
      
      // Clear previous options
      pradeshiyaSabhaSelect.innerHTML = '<option value="">-- Select Pradeshiya Sabha --</option>';
      
      if (district && pradeshiyaSabhasData[district]) {
        pradeshiyaSabhasData[district].forEach(sabha => {
          const option = document.createElement("option");
          option.value = sabha;
          option.textContent = sabha;
          pradeshiyaSabhaSelect.appendChild(option);
        });
      } else {
        // If district not in our data, show a generic option
        const option = document.createElement("option");
        option.value = "other";
        option.textContent = "Other (Please specify)";
        pradeshiyaSabhaSelect.appendChild(option);
      }
      
      // Reset draftsman selection
      document.getElementById("draftsmanSelection").innerHTML = '<p>Please select a pradeshiya sabha to view available draftsmen.</p>';
      selectedDraftsman = null;
    }
    
    // NEW FUNCTION: Load draftsmen from localStorage with Pradeshiya Sabha filter
// buildings.html - ‡Æá‡Æ®‡Øç‡Æ§ function ‡Æê ‡ÆÆ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç

function loadDraftsmenFromLocalStorage() {
    const district = document.getElementById("district").value;
    const pradeshiyaSabha = document.getElementById("pradeshiyaSabha").value;
    const draftsmanSelection = document.getElementById("draftsmanSelection");
    
    if (!district || !pradeshiyaSabha) {
      draftsmanSelection.innerHTML = '<p>Please select a district and pradeshiya sabha to view available draftsmen.</p>';
      return;
    }
    
    // Get approved draftsmen from localStorage (from index.html system)
    const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
    
    // Filter logic: Check Type, Status, District AND Pradeshiya Sabha
    const approvedDraftsmen = providers.filter(p => {
      const isDraftsman = p.type === 'draftsman';
      const isApproved = p.status === 'approved';
      
      // District check (Case insensitive)
      const providerDistrict = p.district ? p.district.toLowerCase() : '';
      const selectedDistrict = district.toLowerCase();
      const districtMatch = providerDistrict === selectedDistrict;
      
      // Pradeshiya Sabha check (Case insensitive matching)
      // Provider Data-‡Æµ‡Æø‡Æ≤‡Øç ‡Æö‡Øá‡ÆÆ‡Æø‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü Pradeshiya Sabha-‡Æµ‡ØÅ‡Æü‡Æ©‡Øç ‡Æí‡Æ™‡Øç‡Æ™‡Æø‡Æü‡ØÅ‡Æ§‡Æ≤‡Øç
      let providerPS = '';
      if (p.pradeshiyaSabha) providerPS = p.pradeshiyaSabha;
      else if (p.psDivision) providerPS = p.psDivision; // ‡Æ™‡Æ¥‡Øà‡ÆØ ‡Æü‡Øá‡Æü‡Øç‡Æü‡Ææ ‡Æá‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡Ææ‡Æ≤‡Øç
      
      const pradeshiyaSabhaMatch = providerPS.toLowerCase() === pradeshiyaSabha.toLowerCase();
      
      return isDraftsman && isApproved && districtMatch && pradeshiyaSabhaMatch;
    });
    
    if (approvedDraftsmen.length === 0) {
      draftsmanSelection.innerHTML = `<p style="color: red;">No approved draftsmen found for <strong>${pradeshiyaSabha}</strong> in <strong>${district}</strong> district.</p>`;
      return;
    }
    
    let html = `<h3>Available Draftsmen in ${pradeshiyaSabha}</h3>`;
    html += '<div class="draftsman-grid">';
    
    approvedDraftsmen.forEach(draftsman => {
      html += `
        <div class="draftsman-card" onclick="selectDraftsmanFromLocalStorage(${draftsman.id})" id="draftsman-${draftsman.id}">
          <h3>${draftsman.name}</h3>
          <p><strong>District:</strong> ${draftsman.district}</p>
          <p><strong>Area:</strong> ${draftsman.pradeshiyaSabha}</p>
          <p><strong>Rate:</strong> ${draftsman.rate || 'Contact for rates'}</p>
          <p><strong>Contact:</strong> ${draftsman.phone || 'Not provided'}</p>
          <button style="margin-top:10px; padding:5px 10px; background:#28a745; color:white; border:none; border-radius:4px; cursor:pointer;">Select</button>
        </div>
      `;
    });
    
    html += '</div>';
    draftsmanSelection.innerHTML = html;
}
    function selectDraftsmanFromLocalStorage(id) {
      const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
      
      // Find the selected draftsman
      selectedDraftsman = providers.find(d => d.id === id);
      
      // Update UI to show selection
      document.querySelectorAll('.draftsman-card').forEach(card => {
        card.classList.remove('selected');
      });
      
      document.getElementById(`draftsman-${id}`).classList.add('selected');
    }
    
    function showReview() {
      const name = document.getElementById("name").value;
      const phone = document.getElementById("phone").value;
      const email = document.getElementById("email").value;
      const nic = document.getElementById("nic").value;
      const projectDetails = document.getElementById("projectDetails").value;
      const district = document.getElementById("district").value;
      const pradeshiyaSabha = document.getElementById("pradeshiyaSabha").value;
      
      let html = `
        <p><strong>Name:</strong> ${name}</p>
        <p><strong>Phone:</strong> ${phone}</p>
        <p><strong>Email:</strong> ${email}</p>
        <p><strong>NIC:</strong> ${nic}</p>
        <p><strong>Project Details:</strong> ${projectDetails}</p>
        <p><strong>District:</strong> ${district}</p>
        <p><strong>Pradeshiya Sabha:</strong> ${pradeshiyaSabha}</p>
      `;
      
      if (selectedDraftsman) {
        html += `
          <p><strong>Selected Draftsman:</strong> ${selectedDraftsman.name}</p>
          <p><strong>Draftsman Email:</strong> ${selectedDraftsman.email}</p>
          <p><strong>Draftsman Phone:</strong> ${selectedDraftsman.phone}</p>
          <p><strong>Draftsman Experience:</strong> ${selectedDraftsman.experience || 'Not specified'} years</p>
        `;
      }
      
      document.getElementById("reviewDetails").innerHTML = html;
    }
    
    // Form submission - UPDATED TO SAVE TO MAIN SYSTEM
    document.getElementById("bookingForm").addEventListener("submit", async function(event){
      event.preventDefault();
      
      if (!validateStep1() || !validateStep2() || !validateStep3()) {
        alert("Please fix the errors in the form.");
        return;
      }
      
      // Show loading indicator
      document.getElementById("loadingIndicator").style.display = "block";
      modal.style.display = "none";
      
      // Collect form data
      const bookingData = {
        id: Date.now(), // Unique ID
        name: document.getElementById("name").value,
        phone: document.getElementById("phone").value,
        email: document.getElementById("email").value,
        nic: document.getElementById("nic").value,
        projectDetails: document.getElementById("projectDetails").value,
        district: document.getElementById("district").value,
        pradeshiyaSabha: document.getElementById("pradeshiyaSabha").value,
        draftsmanId: selectedDraftsman.id,
        draftsmanName: selectedDraftsman.name,
        draftsmanEmail: selectedDraftsman.email,
        draftsmanPhone: selectedDraftsman.phone,
        status: 'pending',
        date: new Date().toISOString().split('T')[0],
        timestamp: new Date().toISOString(),
        type: 'draftsman',
        source: 'buildings.html'
      };
      
      try {
        // Save to main system (index.html's localStorage)
        saveBookingToMainSystem(bookingData);
        
        // Simulate API call with timeout
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // Hide loading indicator
        document.getElementById("loadingIndicator").style.display = "none";
        
        // Show success message
        document.getElementById("successMessage").style.display = "block";
        
        // Reset form
        resetForm();
        
      } catch (error) {
        console.error("Error:", error);
        document.getElementById("loadingIndicator").style.display = "none";
        alert("There was an error submitting your booking. Please try again.");
      }
    });

    // Main system-‡Æï‡Øç‡Æï‡ØÅ booking save ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡ØÅ‡ÆÆ‡Øç function
    function saveBookingToMainSystem(bookingData) {
      try {
        // Main system-‡Æ©‡Øç bookings ‡Æê get ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç
        let existingBookings = [];
        try {
          existingBookings = JSON.parse(localStorage.getItem('bookings') || '[]');
        } catch (e) {
          console.log("No existing bookings found, creating new array");
          existingBookings = [];
        }
        
        // Generate a user ID for the booking (this would come from login in real system)
        const tempUserId = "temp_user_" + Date.now();
        
        // Create the booking object in main system format
        const mainSystemBooking = {
          id: bookingData.id,
          type: 'draftsman',
          providerId: bookingData.draftsmanId,
          providerName: bookingData.draftsmanName,
          userId: tempUserId,
          userName: bookingData.name,
          userEmail: bookingData.email,
          clientName: bookingData.name,
          projectType: 'building',
          projectDetails: bookingData.projectDetails,
          propertyAddress: bookingData.district + ", " + bookingData.pradeshiyaSabha,
          propertySize: 0, // Not specified in form
          preferredVisitDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // One week from now
          contact: bookingData.phone,
          budget: 0, // Not specified in form
          status: 'pending',
          providerResponse: '',
          responseDate: '',
          bookingDate: bookingData.date,
          source: 'buildings.html'
        };
        
        // Add to main bookings array
        existingBookings.push(mainSystemBooking);
        
        // Save back to localStorage
        localStorage.setItem('bookings', JSON.stringify(existingBookings));
        
        console.log('Booking saved to main system:', mainSystemBooking);
        
        // Also save to a separate list for buildings page reference
        const buildingsBookings = JSON.parse(localStorage.getItem('buildingsBookings') || '[]');
        buildingsBookings.push(bookingData);
        localStorage.setItem('buildingsBookings', JSON.stringify(buildingsBookings));
        
        alert('Booking submitted successfully! The draftsman has been notified and will respond to your request.');
        
      } catch (error) {
        console.error("Error saving booking to main system:", error);
        alert("Booking saved locally. The draftsman will be notified when you log in to the main system.");
        
        // Fallback: Save to local storage for this page
        const localBookings = JSON.parse(localStorage.getItem('localDraftsmanBookings') || '[]');
        localBookings.push(bookingData);
        localStorage.setItem('localDraftsmanBookings', JSON.stringify(localBookings));
      }
    }

    // Office contact information functions
    function loadDistrictsContact() {
      const districtSelect = document.getElementById("districtContact");
      
      // Clear previous options
      districtSelect.innerHTML = '<option value="">-- Select District --</option>';
      
      // Add all 25 districts
      districtsData.forEach(district => {
        const option = document.createElement("option");
        option.value = district;
        option.textContent = district;
        districtSelect.appendChild(option);
      });
    }
    
    function loadPradeshiyaSabhasContact() {
      const district = document.getElementById("districtContact").value;
      const pradeshiyaSabhaSelect = document.getElementById("pradeshiyaSabhaContact");
      
      // Clear previous options
      pradeshiyaSabhaSelect.innerHTML = '<option value="">-- Select Pradeshiya Sabha --</option>';
      
      if (district && pradeshiyaSabhasData[district]) {
        pradeshiyaSabhasData[district].forEach(sabha => {
          const option = document.createElement("option");
          option.value = sabha;
          option.textContent = sabha;
          pradeshiyaSabhaSelect.appendChild(option);
        });
      } else {
        // If district not in our data, show a generic option
        const option = document.createElement("option");
        option.value = "other";
        option.textContent = "Other (Please specify)";
        pradeshiyaSabhaSelect.appendChild(option);
      }
      
      // Hide office contact info when district changes
      document.getElementById("officeContactInfo").style.display = "none";
    }
    
    function showOfficeContact() {
      const pradeshiyaSabha = document.getElementById("pradeshiyaSabhaContact").value;
      const officeContactInfo = document.getElementById("officeContactInfo");
      
      if (!pradeshiyaSabha) {
        officeContactInfo.style.display = "none";
        return;
      }
      
      const contactInfo = officeContactData[pradeshiyaSabha];
      
      if (!contactInfo) {
        // If no specific contact info for this pradeshiya sabha, show generic info
        document.getElementById("officePhone").textContent = "+94 021 228 4572";
        document.getElementById("officeEmail").textContent = "buildingoffice@example.com";
        document.getElementById("officeHours").textContent = "Monday-Friday: 8:30 AM - 4:30 PM";
        document.getElementById("officeAddress").textContent = "Please contact the head office for location details";
      } else {
        // Show specific contact info
        document.getElementById("officePhone").textContent = contactInfo.phone;
        document.getElementById("officeEmail").textContent = contactInfo.email;
        document.getElementById("officeHours").textContent = contactInfo.hours;
        document.getElementById("officeAddress").textContent = contactInfo.address;
      }
      
      officeContactInfo.style.display = "block";
    }

    // Initialize districts when page loads
    window.onload = function() {
      loadDistricts();
      loadDistrictsContact(); // Also load districts for contact section
      
      // Update providers with pradeshiya sabha information if needed
      updateProvidersWithPradeshiyaSabha();
    };
    
    // Function to update existing providers with pradeshiya sabha information
    function updateProvidersWithPradeshiyaSabha() {
      const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
      let updated = false;
      
      providers.forEach(provider => {
        if (provider.type === 'draftsman' && !provider.pradeshiyaSabha) {
          // Assign a pradeshiya sabha based on district
          if (provider.district && pradeshiyaSabhasData[provider.district]) {
            // Take the first pradeshiya sabha in the district
            provider.pradeshiyaSabha = pradeshiyaSabhasData[provider.district][0];
            updated = true;
          }
        }
      });
      
      if (updated) {
        localStorage.setItem('serviceProviders', JSON.stringify(providers));
        console.log('Providers updated with pradeshiya sabha information');
      }
    }
  </script>
</body>
</html>
