<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeBridge Rural - Sri Lanka</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Header Styles */
        header {
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
        }
        
        .logo {
            width: 60px;
            height: 60px;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 50%;
        }
        
        .title {
            font-size: 24px;
            font-weight: bold;
            color: #2e8b57;
        }
        
        .title span {
            color: #ff7e00;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 20px;
        }
        
        nav ul li a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s;
            padding: 5px 10px;
            border-radius: 4px;
        }
        
        nav ul li a:hover {
            color: #2e8b57;
            background-color: #f0fff0;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            margin-left: 20px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 10px;
            border: 2px solid #2e8b57;
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-name {
            font-weight: 500;
            color: #333;
        }
        
        .login-btn {
            background: linear-gradient(to right, #2e8b57, #3cb371);
            color: white;
            padding: 8px 15px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .login-btn:hover {
            background: linear-gradient(to right, #246a44, #2e8b57);
            transform: translateY(-2px);
        }
        
        /* Auth Modals */
        .auth-modal, .provider-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .auth-container, .provider-container {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            padding: 30px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .provider-container {
            max-width: 600px;
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .auth-header h2 {
            color: #2e8b57;
            margin-bottom: 10px;
        }
        
        .auth-form .form-group {
            margin-bottom: 20px;
        }
        
        .auth-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        .auth-form input, .auth-form select, .auth-form textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .auth-form input:focus, .auth-form select:focus, .auth-form textarea:focus {
            outline: none;
            border-color: #2e8b57;
        }
        
        .profile-picture-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .profile-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            margin-bottom: 10px;
            border: 3px solid #2e8b57;
        }
        
        .profile-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .auth-form button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(to right, #2e8b57, #3cb371);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .auth-form button:hover {
            background: linear-gradient(to right, #246a44, #2e8b57);
        }
        
        .auth-footer {
            text-align: center;
            margin-top: 20px;
        }
        
        .auth-footer a {
            color: #2e8b57;
            text-decoration: none;
            cursor: pointer;
        }
        
        .auth-footer a:hover {
            text-decoration: underline;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #777;
        }
        
        /* Provider Selection */
        .provider-selection {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .provider-card {
            width: 180px;
            padding: 20px;
            text-align: center;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .provider-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .provider-icon {
            font-size: 2.5rem;
            color: #2e8b57;
            margin-bottom: 15px;
        }
        
        /* User Dashboard */
        .dashboard {
            display: none;
            padding: 40px 0;
        }
        
        .dashboard-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .dashboard-header h2 {
            color: #2e8b57;
            margin-bottom: 10px;
        }
        
        .user-forms-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .form-card {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .form-card h3 {
            color: #2e8b57;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #2e8b57;
        }
        
        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .submit-btn {
            padding: 12px 25px;
            background: linear-gradient(to right, #2e8b57, #3cb371);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .submit-btn:hover {
            background: linear-gradient(to right, #246a44, #2e8b57);
        }
        
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 40px;
        }
        
        .category-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .category-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.15);
        }
        
        .category-icon {
            height: 120px;
            background: linear-gradient(to right, #2e8b57, #ff7e00);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
        }
        
        .category-content {
            padding: 25px;
        }
        
        .category-content h3 {
            margin-bottom: 15px;
            color: #2e8b57;
            font-size: 1.3rem;
        }
        
        .category-content p {
            color: #666;
            font-size: 0.95rem;
        }
        
        /* Admin Panel */
        .admin-panel {
            display: none;
            padding: 40px 0;
        }
        
        .admin-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .admin-header h2 {
            color: #2e8b57;
            margin-bottom: 10px;
        }
        
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .stat-card h3 {
            color: #2e8b57;
            margin-bottom: 10px;
        }
        
        .stat-card .number {
            font-size: 2rem;
            font-weight: bold;
            color: #ff7e00;
        }
        
        .admin-actions {
            margin-bottom: 30px;
        }
        
        .admin-actions h3 {
            color: #2e8b57;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .admin-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .control-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .control-card h4 {
            color: #2e8b57;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .control-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .control-form input, .control-form select, .control-form textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .control-form button {
            padding: 10px;
            background-color: #2e8b57;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .control-form button:hover {
            background-color: #246a44;
        }
        
        .users-list, .solutions-table, .submissions-table, .bookings-table, .doctors-table, .providers-table, .provider-bookings-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .users-list th, .users-list td,
        .solutions-table th, .solutions-table td,
        .submissions-table th, .submissions-table td,
        .bookings-table th, .bookings-table td,
        .doctors-table th, .doctors-table td,
        .providers-table th, .providers-table td,
        .provider-bookings-table th, .provider-bookings-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .users-list th, .solutions-table th, .submissions-table th, .bookings-table th, .doctors-table th, .providers-table th, .provider-bookings-table th {
            background-color: #2e8b57;
            color: white;
        }
        
        .users-list tr:hover, .solutions-table tr:hover, .submissions-table tr:hover, .bookings-table tr:hover, .doctors-table tr:hover, .providers-table tr:hover, .provider-bookings-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .action-btn {
            padding: 5px 10px;
            margin-right: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
        }
        
        .edit-btn {
            background-color: #ffc107;
            color: #333;
        }
        
        .delete-btn {
            background-color: #dc3545;
            color: white;
        }
        
        .view-btn {
            background-color: #2e8b57;
            color: white;
        }
        
        .approve-btn {
            background-color: #28a745;
            color: white;
        }
        
        .reject-btn {
            background-color: #dc3545;
            color: white;
        }
        
        .reply-btn {
            background-color: #17a2b8;
            color: white;
        }
        
        /* Submission Modal */
        .submission-modal, .booking-details-modal, .response-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .submission-container, .booking-details-container, .response-container {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            padding: 30px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .submission-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .submission-header h2 {
            color: #2e8b57;
            margin-bottom: 10px;
        }
        
        .submission-details {
            margin-bottom: 20px;
        }
        
        .submission-detail-item {
            display: flex;
            margin-bottom: 15px;
        }
        
        .submission-detail-label {
            font-weight: 500;
            min-width: 120px;
            color: #555;
        }
        
        .submission-detail-value {
            color: #333;
            flex: 1;
        }
        
        /* Service Provider Dashboard */
        .provider-dashboard {
            display: none;
            padding: 40px 0;
        }
        
        .provider-welcome {
            background: linear-gradient(to right, #2e8b57, #3cb371);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .provider-welcome h2 {
            margin-bottom: 10px;
        }
        
        .provider-info-card {
            display: flex;
            align-items: center;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .provider-avatar-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 20px;
            border: 3px solid #2e8b57;
        }
        
        .provider-avatar-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .provider-details {
            flex: 1;
        }
        
        .provider-details h3 {
            color: #2e8b57;
            margin-bottom: 5px;
        }
        
        .provider-details p {
            color: #666;
            margin-bottom: 5px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-approved {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .status-rejected {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .status-completed {
            background-color: #d4edda;
            color: #155724;
        }
        
        /* News Section Styles */
        .news-section {
            padding: 60px 0;
            background-color: #f0f8f0;
        }
        
        .news-container {
            margin-top: 30px;
        }
        
        .news-filters {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .news-filter-btn {
            padding: 8px 16px;
            background-color: white;
            border: 2px solid #2e8b57;
            border-radius: 30px;
            color: #2e8b57;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .news-filter-btn.active, .news-filter-btn:hover {
            background-color: #2e8b57;
            color: white;
        }
        
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .news-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
        }
        
        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .news-image {
            height: 180px;
            overflow: hidden;
        }
        
        .news-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }
        
        .news-card:hover .news-image img {
            transform: scale(1.05);
        }
        
        .news-content {
            padding: 20px;
        }
        
        .news-category {
            display: inline-block;
            padding: 4px 10px;
            background-color: #e6f7ee;
            color: #2e8b57;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 10px;
        }
        
        .news-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #333;
        }
        
        .news-excerpt {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.95rem;
        }
        
        .news-date {
            color: #888;
            font-size: 0.85rem;
        }
        
        .no-news {
            text-align: center;
            grid-column: 1 / -1;
            padding: 40px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        /* Read More Button */
        .read-more-btn {
            padding: 8px 15px;
            background: linear-gradient(to right, #2e8b57, #3cb371);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 0;
            display: inline-block;
        }
        
        .read-more-btn:hover {
            background: linear-gradient(to right, #246a44, #2e8b57);
        }
        
        /* News Admin Controls */
        .news-admin-controls {
            margin-top: 30px;
        }
        
        /* Responsive Design */
        @media (max-width: 968px) {
            .user-forms-container {
                grid-template-columns: 1fr;
            }
            
            .news-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .provider-selection {
                flex-direction: column;
                align-items: center;
            }
        }
        
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                text-align: center;
            }
            
            nav ul {
                margin-top: 15px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            nav ul li {
                margin: 5px 10px;
            }
            
            .user-profile {
                margin-top: 15px;
                justify-content: center;
            }
            
            .section-title {
                font-size: 28px;
            }
            
            .admin-controls {
                grid-template-columns: 1fr;
            }
            
            .users-list, .solutions-table, .submissions-table, .bookings-table, .doctors-table, .providers-table, .provider-bookings-table {
                font-size: 0.9rem;
            }
            
            .users-list th, .users-list td,
            .solutions-table th, .solutions-table td,
            .submissions-table th, .submissions-table td,
            .bookings-table th, .bookings-table td,
            .doctors-table th, .doctors-table td,
            .providers-table th, .providers-table td,
            .provider-bookings-table th, .provider-bookings-table td {
                padding: 8px 10px;
            }
            
            .submission-detail-item {
                flex-direction: column;
            }
            
            .submission-detail-label {
                margin-bottom: 5px;
            }
            
            .news-filters {
                flex-direction: column;
                align-items: center;
            }
            
            .news-filter-btn {
                width: 200px;
                text-align: center;
            }
            
            .provider-info-card {
                flex-direction: column;
                text-align: center;
            }
            
            .provider-avatar-large {
                margin-right: 0;
                margin-bottom: 15px;
            }
        }

        /* Banner Styles */
        .banner {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1532629345422-7515f3d16bb6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1500&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            text-align: center;
            padding: 100px 20px;
            margin-bottom: 40px;
        }
        
        .banner h1 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .banner p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 30px;
            line-height: 1.6;
        }
        
        .tagline {
            font-style: italic;
            margin-top: 20px;
            color: #a2f5bf;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 40px;
            color: #2e8b57;
            font-size: 32px;
            position: relative;
        }
        
        .section-title:after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background: linear-gradient(to right, #2e8b57, #ff7e00);
            margin: 10px auto;
            border-radius: 2px;
        }
        
        /* Footer */
        footer {
            background-color: #2c3e50;
            color: white;
            padding: 50px 0 20px;
            margin-top: 60px;
        }
        
        .footer-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        
        .footer-section {
            flex: 1;
            min-width: 200px;
            margin-bottom: 30px;
        }
        
        .footer-section h3 {
            margin-bottom: 20px;
            color: #3cb371;
            font-size: 1.3rem;
        }
        
        .footer-section ul {
            list-style: none;
            padding: 0;
        }
        
        .footer-section ul li {
            margin-bottom: 10px;
        }
        
        .footer-section a {
            color: #ddd;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-section a:hover {
            color: #3cb371;
        }
        
        .social-icons {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .social-icons a {
            display: inline-block;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            color: white;
            transition: all 0.3s;
        }
        
        .social-icons a:hover {
            background-color: #3cb371;
            transform: translateY(-3px);
        }
        
        .copyright {
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            font-size: 0.9rem;
            color: #aaa;
        }
        
        /* Doctor Card Styles */
        .doctor-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        
        .doctor-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        
        .doctor-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
        }
        
        /* Service Providers Section */
        .providers-section {
            padding: 60px 0;
            background-color: #f0f8ff;
        }
        
        .providers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }
        
        .provider-service-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            text-align: center;
            padding: 30px;
        }
        
        .provider-service-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.15);
        }
        
        .provider-service-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(to right, #2e8b57, #3cb371);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
        }
        
        /* Booking Form Styles */
        .booking-form-container {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* Tabs for Provider Dashboard */
        .provider-tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 30px;
        }
        
        .provider-tab {
            padding: 15px 25px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .provider-tab.active {
            color: #2e8b57;
            border-bottom: 3px solid #2e8b57;
        }
        
        .provider-tab:hover:not(.active) {
            color: #2e8b57;
            background-color: #f9f9f9;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="auth-modal" id="loginModal">
        <div class="auth-container">
            <button class="close-btn" onclick="closeAuthModal()">&times;</button>
            <div class="auth-header">
                <h2>Login to Your Account</h2>
                <p>Enter your credentials to access the portal</p>
            </div>
            
            <form class="auth-form" id="loginForm" onsubmit="handleLogin(event)" novalidate>
                <div class="form-group">
                    <label for="loginEmail">Email Address</label>
                    <input type="email" id="loginEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" required>
                </div>
                
                <div class="form-group">
                    <label for="loginRole">Login As</label>
                    <select id="loginRole" required>
                        <option value="">Select Role</option>
                        <option value="user">User</option>
                        <option value="doctor">Doctor</option>
                        <option value="draftsman">Draftsman</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                
                <button type="submit">Login</button>
            </form>
            
            <div class="auth-footer">
                <p>Don't have an account? <a onclick="showSignupModal()">Sign up here</a></p>
                <p>Are you a service provider? <a onclick="showProviderSelectionModal()">Register here</a></p>
            </div>
        </div>
    </div>

    <!-- Signup Modal -->
    <div class="auth-modal" id="signupModal">
        <div class="auth-container">
            <button class="close-btn" onclick="closeAuthModal()">&times;</button>
            <div class="auth-header">
                <h2>Create an Account</h2>
                <p>Join LifeBridge Rural to access resources</p>
            </div>
            
            <div class="profile-picture-upload">
                <div class="profile-preview">
                    <img src="https://ui-avatars.com/api/?name=User&background=2e8b57&color=fff" alt="Profile Preview" id="profilePreview">
                </div>
                <input type="file" id="profilePicture" accept="image/*" style="display: none;">
                <button type="button" class="submit-btn" onclick="document.getElementById('profilePicture').click()">Choose Profile Picture</button>
            </div>
            
            <form class="auth-form" id="signupForm" onsubmit="handleSignup(event)" novalidate>
                <div class="form-group">
                    <label for="signupName">Full Name</label>
                    <input type="text" id="signupName" placeholder="Enter your full name" required>
                </div>
                
                <div class="form-group">
                    <label for="signupEmail">Email Address</label>
                    <input type="email" id="signupEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" placeholder="Create a password" required>
                </div>
                
                <div class="form-group">
                    <label for="signupConfirmPassword">Confirm Password</label>
                    <input type="password" id="signupConfirmPassword" placeholder="Confirm your password" required>
                </div>
                
                <input type="hidden" id="signupRole" value="user">
                
                <button type="submit">Create Account</button>
            </form>
            
            <div class="auth-footer">
                <p>Already have an account? <a onclick="showLoginModal()">Login here</a></p>
                <p>Are you a service provider? <a onclick="showProviderSelectionModal()">Register here</a></p>
            </div>
        </div>
    </div>

    <!-- Provider Selection Modal -->
    <div class="provider-modal" id="providerSelectionModal">
        <div class="provider-container">
            <button class="close-btn" onclick="closeProviderModal()">&times;</button>
            <div class="auth-header">
                <h2>Register as Service Provider</h2>
                <p>Select your profession to register</p>
            </div>
            
            <div class="provider-selection">
                <div class="provider-card" onclick="showProviderRegistrationForm('doctor')">
                    <div class="provider-icon">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <h3>Doctor</h3>
                    <p>Medical professional providing healthcare services</p>
                </div>
                
                <div class="provider-card" onclick="showProviderRegistrationForm('draftsman')">
                    <div class="provider-icon">
                        <i class="fas fa-ruler-combined"></i>
                    </div>
                    <h3>Draftsman</h3>
                    <p>Technical drawing specialist for construction plans</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Provider Registration Modal - UPDATED VERSION with Pradeshiya Sabha -->
    <div class="provider-modal" id="providerRegistrationModal">
        <div class="provider-container">
            <button class="close-btn" onclick="closeProviderRegistrationModal()">&times;</button>
            <div class="auth-header">
                <h2 id="providerFormTitle">Register as Service Provider</h2>
                <p id="providerFormSubtitle">Please provide your professional details</p>
            </div>
            
            <div class="profile-picture-upload">
                <div class="profile-preview">
                    <img src="https://ui-avatars.com/api/?name=Provider&background=2e8b57&color=fff" alt="Profile Preview" id="providerProfilePreview">
                </div>
                <input type="file" id="providerProfilePicture" accept="image/*" style="display: none;">
                <button type="button" class="submit-btn" onclick="document.getElementById('providerProfilePicture').click()">Choose Profile Picture</button>
            </div>
            
            <form class="auth-form" id="providerRegistrationForm" onsubmit="handleProviderRegistration(event)" novalidate>
                <input type="hidden" id="providerType" value="">
                
                <!-- Common Fields -->
                <div class="form-group">
                    <label for="providerName">Full Name</label>
                    <input type="text" id="providerName" placeholder="Enter your full name" required>
                </div>
                
                <div class="form-group">
                    <label for="providerEmail">Email Address</label>
                    <input type="email" id="providerEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="providerPassword">Password</label>
                    <input type="password" id="providerPassword" placeholder="Create a password" required>
                </div>
                
                <div class="form-group">
                    <label for="providerConfirmPassword">Confirm Password</label>
                    <input type="password" id="providerConfirmPassword" placeholder="Confirm your password" required>
                </div>
                
                <div class="form-group">
                    <label for="providerPhone">Phone Number</label>
                    <input type="tel" id="providerPhone" placeholder="Enter your phone number" required>
                </div>
                
                <div class="form-group">
                    <label for="providerAddress">Address</label>
                    <textarea id="providerAddress" placeholder="Enter your complete address" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="providerDistrict">District</label>
                    <select id="providerDistrict" required onchange="loadPradeshiyaSabhasForProvider()">
                        <option value="">Select District</option>
                        <option value="ampara">Ampara</option>
                        <option value="anuradhapura">Anuradhapura</option>
                        <option value="badulla">Badulla</option>
                        <option value="batticaloa">Batticaloa</option>
                        <option value="colombo">Colombo</option>
                        <option value="galle">Galle</option>
                        <option value="gampaha">Gampaha</option>
                        <option value="hambantota">Hambantota</option>
                        <option value="jaffna">Jaffna</option>
                        <option value="kalutara">Kalutara</option>
                        <option value="kandy">Kandy</option>
                        <option value="kegalle">Kegalle</option>
                        <option value="kilinochchi">Kilinochchi</option>
                        <option value="kurunegala">Kurunegala</option>
                        <option value="mannar">Mannar</option>
                        <option value="matale">Matale</option>
                        <option value="matara">Matara</option>
                        <option value="monaragala">Monaragala</option>
                        <option value="mullaitivu">Mullaitivu</option>
                        <option value="nuwara-eliya">Nuwara Eliya</option>
                        <option value="polonnaruwa">Polonnaruwa</option>
                        <option value="puttalam">Puttalam</option>
                        <option value="ratnapura">Ratnapura</option>
                        <option value="trincomalee">Trincomalee</option>
                        <option value="vavuniya">Vavuniya</option>
                    </select>
                </div>
                
                <!-- Pradeshiya Sabha Field - NEW ADDITION -->
                <div class="form-group">
                    <label for="providerPradeshiyaSabha">Pradeshiya Sabha</label>
                    <select id="providerPradeshiyaSabha" required>
                        <option value="">Select Pradeshiya Sabha</option>
                        <!-- Options will be loaded dynamically -->
                    </select>
                </div>
                
                <!-- Doctor Specific Fields -->
                <div id="doctorFields" style="display: none;">
                    <div class="form-group">
                        <label for="doctorSpecialization">Specialization</label>
                        <select id="doctorSpecialization">
                            <option value="">Select Specialization</option>
                            <option value="general">General Practitioner</option>
                            <option value="pediatrics">Pediatrics</option>
                            <option value="gynecology">Gynecology</option>
                            <option value="cardiology">Cardiology</option>
                            <option value="dermatology">Dermatology</option>
                            <option value="orthopedics">Orthopedics</option>
                            <option value="psychiatry">Psychiatry</option>
                            <option value="dentistry">Dentistry</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="doctorQualification">Qualifications</label>
                        <input type="text" id="doctorQualification" placeholder="MBBS, MD, etc.">
                    </div>
                    
                    <div class="form-group">
                        <label for="doctorRegistrationNo">Medical Registration Number</label>
                        <input type="text" id="doctorRegistrationNo" placeholder="Enter your registration number">
                    </div>
                    
                    <div class="form-group">
                        <label for="doctorExperience">Years of Experience</label>
                        <input type="number" id="doctorExperience" placeholder="Number of years" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="doctorHospital">Hospital/Clinic Name</label>
                        <input type="text" id="doctorHospital" placeholder="Name of your hospital or clinic">
                    </div>
                    
                    <div class="form-group">
                        <label for="doctorAvailability">Availability</label>
                        <input type="text" id="doctorAvailability" placeholder="e.g., Mon-Fri 9am-5pm, Sat 9am-1pm">
                    </div>
                    
                    <div class="form-group">
                        <label for="doctorConsultationFee">Consultation Fee (LKR)</label>
                        <input type="number" id="doctorConsultationFee" placeholder="Fee per consultation" min="0">
                    </div>
                </div>
                
                <!-- Draftsman Specific Fields -->
                <div id="draftsmanFields" style="display: none;">
                    <div class="form-group">
                        <label for="draftsmanQualification">Qualifications</label>
                        <input type="text" id="draftsmanQualification" placeholder="Diploma/Degree in Drafting, etc.">
                    </div>
                    
                    <div class="form-group">
                        <label for="draftsmanRegistrationNo">Professional Registration Number</label>
                        <input type="text" id="draftsmanRegistrationNo" placeholder="Enter your registration number">
                    </div>
                    
                    <div class="form-group">
                        <label for="draftsmanExperience">Years of Experience</label>
                        <input type="number" id="draftsmanExperience" placeholder="Number of years" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="draftsmanServices">Services Offered</label>
                        <textarea id="draftsmanServices" placeholder="List the services you offer (e.g., house plans, site plans, etc.)" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="draftsmanRate">Service Rate (LKR)</label>
                        <input type="text" id="draftsmanRate" placeholder="e.g., 10,000 per plan or hourly rate">
                    </div>
                    
                    <div class="form-group">
                        <label for="draftsmanAvailability">Availability</label>
                        <input type="text" id="draftsmanAvailability" placeholder="e.g., Mon-Fri 9am-5pm, Weekends by appointment">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="providerBio">Professional Bio</label>
                    <textarea id="providerBio" placeholder="Tell us about your professional background and experience" rows="4" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="providerTerms" required>
                        I certify that all information provided is accurate and I am a legitimate professional in my field
                    </label>
                </div>
                
                <button type="submit">Submit Registration</button>
            </form>
            
            <div class="auth-footer">
                <p>Already have an account? <a onclick="showLoginModal()">Login here</a></p>
            </div>
        </div>
    </div>

    <!-- Submission Modal -->
    <div class="submission-modal" id="submissionModal">
        <div class="submission-container">
            <button class="close-btn" onclick="closeSubmissionModal()">&times;</button>
            <div class="submission-header">
                <h2>User Problem Submission</h2>
                <p>Detailed information about the user's problem</p>
            </div>
            
            <div class="submission-details" id="submissionDetails">
                <!-- Submission details will be dynamically added here -->
            </div>
        </div>
    </div>

    <!-- Booking Details Modal -->
    <div class="booking-details-modal" id="bookingDetailsModal">
        <div class="booking-details-container">
            <button class="close-btn" onclick="closeBookingDetailsModal()">&times;</button>
            <div class="submission-header">
                <h2 id="bookingDetailsTitle">Booking Details</h2>
                <p>Detailed information about the booking</p>
            </div>
            
            <div class="submission-details" id="bookingDetailsContent">
                <!-- Booking details will be dynamically added here -->
            </div>
            
            <div id="responseSection" style="display: none; margin-top: 20px;">
                <h3 style="color: #2e8b57; margin-bottom: 15px;">Your Response</h3>
                <div id="existingResponse">
                    <!-- Existing response will be shown here -->
                </div>
                <div id="responseFormContainer">
                    <textarea id="providerResponse" placeholder="Enter your response to the user..." rows="4" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;"></textarea>
                    <div style="display: flex; gap: 10px;">
                        <button type="button" class="submit-btn" onclick="submitProviderResponse()" style="flex: 1;">Submit Response</button>
                        <button type="button" class="submit-btn" onclick="markBookingAsCompleted()" style="flex: 1; background: linear-gradient(to right, #28a745, #20c997);">Mark as Completed</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Response Modal -->
    <div class="response-modal" id="responseModal">
        <div class="response-container">
            <button class="close-btn" onclick="closeResponseModal()">&times;</button>
            <div class="submission-header">
                <h2>Provider Response</h2>
                <p>Provider's response to your booking</p>
            </div>
            
            <div class="submission-details" id="responseDetails">
                <!-- Response details will be dynamically added here -->
            </div>
        </div>
    </div>

    <!-- Header with Logo and Navigation -->
    <header>
        <div class="container header-container">
            <div class="logo-container">
                <div class="logo">
                    <img src="logo.jpg" alt="LifeBridge Rural Logo" id="siteLogo">
                </div>
                <div class="title">Life<span>Bridge</span> Rural</div>
            </div>
            <nav>
                <ul>
                    <li><a href="#" onclick="showHome()">Home</a></li>
                    <li><a href="#" onclick="showDashboard()">Dashboard</a></li>
                    <li><a href="#" onclick="showAdminPanel()">Admin</a></li>
                    <li><a href="#" onclick="showServiceProviders()">Service Providers</a></li>
                    <li><a href="#" onclick="showProviderDashboard()">Provider Dashboard</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </nav>
            <div class="user-profile" id="userProfileSection">
                <div class="user-avatar">
                    <img src="https://ui-avatars.com/api/?name=User&background=2e8b57&color=fff" alt="User" id="userAvatar">
                </div>
                <div class="user-name" id="userName">Guest</div>
            </div>
            <a class="login-btn" id="authButton" onclick="showLoginModal()">Login</a>
        </div>
    </header>

    <!-- Home Page Content -->
    <div class="home-content" id="homeContent">
        <!-- Banner Section -->
        <section class="banner">
            <div class="container">
                <h1>Bridging Sri Lankan Villages to Resources</h1>
                <p>LifeBridge Rural is designed to act as a bridge between rural communities in Sri Lanka and the resources they need to thrive</p>
                <p class="tagline">"Connecting rural Sri Lankan communities to opportunities, resources, and a brighter future"</p>
            </div>
        </section>

        <!-- Categories Section -->
        <section class="categories">
            <div class="container">
                <h2 class="section-title">Key Challenges for Rural Sri Lankan Communities</h2>
                <div class="categories-grid">
                    <div class="category-card">
                        <div class="category-icon"><i class="fas fa-landmark"></i></div>
                        <div class="category-content">
                            <h3>Government Schemes & Financial Aid</h3>
                            <p>Information on schemes like "Gama Samaga Pilisandarak", "Divi Neguma", and other rural development programs.</p>
                        </div>
                    </div>
                    
                    <div class="category-card">
                        <div class="category-icon"><i class="fas fa-file-alt"></i></div>
                        <div class="category-content">
                            <h3>Government Regulations & Permissions</h3>
                            <p>Guidance on obtaining permits for agriculture, small businesses, and housing in rural areas.</p>
                        </div>
                    </div>
                    
                    <div class="category-card">
                        <div class="category-icon"><i class="fas fa-heartbeat"></i></div>
                        <div class="category-content">
                            <h3>Health & Safety</h3>
                            <p>Access to information about rural health services, CKDu prevention, and maternal healthcare programs.</p>
                        </div>
                    </div>
                    
                    <div class="category-card">
                        <div class="category-icon"><i class="fas fa-tractor"></i></div>
                        <div class="category-content">
                            <h3>Agriculture & Market</h3>
                            <p>Support for tea, rubber, coconut, and spice farmers with market prices and modern techniques.</p>
                        </div>
                    </div>
                    
                    <div class="category-card">
                        <div class="category-icon"><i class="fas fa-hands-helping"></i></div>
                        <div class="category-content">
                            <h3>Social Welfare & Others</h3>
                            <p>Information on Samurdhi benefits, educational scholarships, and vocational training programs.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Service Providers Section -->
        <section class="providers-section" id="serviceProvidersSection">
            <div class="container">
                <h2 class="section-title">Our Service Providers</h2>
                <p style="text-align: center; max-width: 800px; margin: 0 auto 30px; color: #666;">
                    Connect with certified professionals who can help you with your specific needs. All providers are verified by our admin team.
                </p>
                
                <div class="providers-grid">
                    <div class="provider-service-card">
                        <div class="provider-service-icon">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <h3>Medical Services</h3>
                        <p>Book appointments with certified doctors specializing in various fields. Get medical consultations and health advice.</p>
                        <div style="margin-top: 20px;">
                            <button class="read-more-btn" onclick="showAvailableDoctors()">View Available Doctors</button>
                            <button class="read-more-btn" style="background: linear-gradient(to right, #ff7e00, #ff9f40); margin-top: 10px;" onclick="bookDoctor()">Book a Doctor</button>
                        </div>
                    </div>
                    
                    <div class="provider-service-card">
                        <div class="provider-service-icon">
                            <i class="fas fa-ruler-combined"></i>
                        </div>
                        <h3>Draftsman Services</h3>
                        <p>Get professional drafting services for construction plans, site plans, and architectural drawings for your projects.</p>
                        <div style="margin-top: 20px;">
                            <button class="read-more-btn" onclick="showAvailableDraftsmen()">View Available Draftsmen</button>
                            <button class="read-more-btn" style="background: linear-gradient(to right, #ff7e00, #ff9f40); margin-top: 10px;" onclick="bookDraftsman()">Book a Draftsman</button>
                        </div>
                    </div>
                </div>
                
                <!-- Available Doctors List -->
                <div id="availableDoctors" style="display: none; margin-top: 40px;">
                    <h3 style="color: #2e8b57; margin-bottom: 20px; text-align: center;">Available Doctors</h3>
                    <div id="doctorsList" class="categories-grid">
                        <!-- Doctors will be dynamically added here -->
                    </div>
                </div>
                
                <!-- Available Draftsmen List -->
                <div id="availableDraftsmen" style="display: none; margin-top: 40px;">
                    <h3 style="color: #2e8b57; margin-bottom: 20px; text-align: center;">Available Draftsmen</h3>
                    <div id="draftsmenList" class="categories-grid">
                        <!-- Draftsmen will be dynamically added here -->
                    </div>
                </div>
                
                <!-- Doctor Booking Form -->
                <div id="doctorBookingForm" class="booking-form-container" style="display: none;">
                    <h3 style="color: #2e8b57; margin-bottom: 20px;">Book a Doctor Appointment</h3>
                    <form id="doctorBookingFormContent" onsubmit="submitDoctorBooking(event)" novalidate>
                        <div class="form-group">
                            <label for="bookingDoctor">Select Doctor</label>
                            <select id="bookingDoctor" required>
                                <option value="">Select a doctor</option>
                                <!-- Doctors will be dynamically added here -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="patientName">Patient Name</label>
                            <input type="text" id="patientName" placeholder="Enter patient's full name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="patientAge">Patient Age</label>
                            <input type="number" id="patientAge" placeholder="Enter age" min="0" max="120" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="patientGender">Patient Gender</label>
                            <select id="patientGender" required>
                                <option value="">Select gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="medicalIssue">Medical Issue/Concern</label>
                            <textarea id="medicalIssue" placeholder="Describe the medical issue or concern" rows="3" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="preferredDate">Preferred Date</label>
                            <input type="date" id="preferredDate" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="preferredTime">Preferred Time</label>
                            <input type="time" id="preferredTime" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="bookingContact">Contact Number</label>
                            <input type="tel" id="bookingContact" placeholder="Enter contact number" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="bookingNotes">Additional Notes</label>
                            <textarea id="bookingNotes" placeholder="Any additional information or special requirements" rows="2"></textarea>
                        </div>
                        
                        <button type="submit" class="submit-btn">Book Appointment</button>
                        <button type="button" class="submit-btn" onclick="cancelBooking()" style="background: linear-gradient(to right, #6c757d, #868e96); margin-left: 10px;">Cancel</button>
                    </form>
                </div>
                
                <!-- Draftsman Booking Form -->
                <div id="draftsmanBookingForm" class="booking-form-container" style="display: none;">
                    <h3 style="color: #2e8b57; margin-bottom: 20px;">Book a Draftsman</h3>
                    <form id="draftsmanBookingFormContent" onsubmit="submitDraftsmanBooking(event)" novalidate>
                        <div class="form-group">
                            <label for="bookingDraftsman">Select Draftsman</label>
                            <select id="bookingDraftsman" required>
                                <option value="">Select a draftsman</option>
                                <!-- Draftsmen will be dynamically added here -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="clientName">Client Name</label>
                            <input type="text" id="clientName" placeholder="Enter your full name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="projectType">Project Type</label>
                            <select id="projectType" required>
                                <option value="">Select project type</option>
                                <option value="house">House Plan</option>
                                <option value="commercial">Commercial Building</option>
                                <option value="renovation">Renovation Plan</option>
                                <option value="site">Site Plan</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="projectDetails">Project Details</label>
                            <textarea id="projectDetails" placeholder="Describe your project requirements in detail" rows="3" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="propertyAddress">Property Address</label>
                            <textarea id="propertyAddress" placeholder="Enter complete property address" rows="2" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="propertySize">Property Size (perches)</label>
                            <input type="number" id="propertySize" placeholder="Enter property size in perches" min="0" step="0.01" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="preferredVisitDate">Preferred Site Visit Date</label>
                            <input type="date" id="preferredVisitDate" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="draftsmanContact">Contact Number</label>
                            <input type="tel" id="draftsmanContact" placeholder="Enter contact number" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="draftsmanBudget">Budget Estimate (LKR)</label>
                            <input type="number" id="draftsmanBudget" placeholder="Enter estimated budget" min="0" required>
                        </div>
                        
                        <button type="submit" class="submit-btn">Book Draftsman</button>
                        <button type="button" class="submit-btn" onclick="cancelBooking()" style="background: linear-gradient(to right, #6c757d, #868e96); margin-left: 10px;">Cancel</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- News Section -->
        <section class="news-section" id="newsSection">
            <div class="container">
                <h2 class="section-title">Latest News & Updates</h2>
                
                <div class="news-filters">
                    <button class="news-filter-btn active" data-category="all">All News</button>
                    <button class="news-filter-btn" data-category="government">Government Schemes</button>
                    <button class="news-filter-btn" data-category="regulations">Regulations</button>
                    <button class="news-filter-btn" data-category="health">Health & Safety</button>
                    <button class="news-filter-btn" data-category="agriculture">Agriculture</button>
                    <button class="news-filter-btn" data-category="welfare">Social Welfare</button>
                </div>
                
                <div class="news-container">
                    <div class="news-grid" id="newsGrid">
                        <!-- News items will be dynamically added here -->
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- User Dashboard -->
    <div class="dashboard container" id="userDashboard">
        <div class="dashboard-header">
            <h2>Welcome to Your Dashboard</h2>
            <p>Manage your profile and submit your problems for assistance</p>
        </div>
        
        <div class="user-forms-container">
            <div class="form-card">
                <h3>Personal Information</h3>
                <form id="personalInfoForm" onsubmit="updatePersonalInfo(event)" novalidate>
                    <div class="form-group">
                        <label for="personalName">Full Name</label>
                        <input type="text" id="personalName" placeholder="Enter your full name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="personalEmail">Email Address</label>
                        <input type="email" id="personalEmail" placeholder="Enter your email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="personalPhone">Phone Number</label>
                        <input type="tel" id="personalPhone" placeholder="Enter your phone number" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="personalAddress">Address</label>
                        <textarea id="personalAddress" placeholder="Enter your complete address" rows="3" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="personalDistrict">District</label>
                        <select id="personalDistrict" required>
                            <option value="">Select District</option>
                            <option value="ampara">Ampara</option>
                            <option value="anuradhapura">Anuradhapura</option>
                            <option value="badulla">Badulla</option>
                            <option value="batticaloa">Batticaloa</option>
                            <option value="colombo">Colombo</option>
                            <option value="galle">Galle</option>
                            <option value="gampaha">Gampaha</option>
                            <option value="hambantota">Hambantota</option>
                            <option value="jaffna">Jaffna</option>
                            <option value="kalutara">Kalutara</option>
                            <option value="kandy">Kandy</option>
                            <option value="kegalle">Kegalle</option>
                            <option value="kilinochchi">Kilinochchi</option>
                            <option value="kurunegala">Kurunegala</option>
                            <option value="mannar">Mannar</option>
                            <option value="matale">Matale</option>
                            <option value="matara">Matara</option>
                            <option value="monaragala">Monaragala</option>
                            <option value="mullaitivu">Mullaitivu</option>
                            <option value="nuwara-eliya">Nuwara Eliya</option>
                            <option value="polonnaruwa">Polonnaruwa</option>
                            <option value="puttalam">Puttalam</option>
                            <option value="ratnapura">Ratnapura</option>
                            <option value="trincomalee">Trincomalee</option>
                            <option value="vavuniya">Vavuniya</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="personalPradeshiyaSabha">Pradeshiya Sabha</label>
                        <input type="text" id="personalPradeshiyaSabha" placeholder="Enter your Pradeshiya Sabha">
                    </div>
                    
                    <button type="submit" class="submit-btn">Update Information</button>
                </form>
            </div>
            
            <div class="form-card">
                <h3>Submit Your Problem</h3>
                <form id="problemForm" onsubmit="submitProblemForm(event)" novalidate>
                    <div class="form-group">
                        <label for="problemCategory">Problem Category</label>
                        <select id="problemCategory" required>
                            <option value="">Select a category</option>
                            <option value="government">Government Schemes & Financial Aid</option>
                            <option value="regulations">Government Regulations & Permissions</option>
                            <option value="health">Health & Safety</option>
                            <option value="agriculture">Agriculture & Market</option>
                            <option value="welfare">Social Welfare & Others</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="problemTitle">Problem Title</label>
                        <input type="text" id="problemTitle" placeholder="Brief title of your problem" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="problemDescription">Problem Description</label>
                        <textarea id="problemDescription" placeholder="Please describe your problem in detail..." required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="problemLocation">Location/Village</label>
                        <input type="text" id="problemLocation" placeholder="Enter your village or location" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="problemContact">Contact Number</label>
                        <input type="tel" id="problemContact" placeholder="Enter your contact number" required>
                    </div>
                    
                    <button type="submit" class="submit-btn">Submit Problem</button>
                </form>
            </div>
        </div>
        
        <!-- User Bookings Section -->
        <div class="form-card" style="margin-top: 30px;">
            <h3>Your Bookings</h3>
            <div id="userBookingsList">
                <!-- User's bookings will be dynamically added here -->
            </div>
        </div>
        
        <h2 class="section-title">Browse Solutions by Category</h2>
        <div class="categories-grid">
            <div class="category-card" onclick="navigateToCategory('government')">
                <div class="category-icon"><i class="fas fa-landmark"></i></div>
                <div class="category-content">
                    <h3>Government Schemes & Financial Aid</h3>
                    <p>Find information about government programs and financial assistance.</p>
                </div>
            </div>
            
            <div class="category-card" onclick="navigateToCategory('regulations')">
                <div class="category-icon"><i class="fas fa-file-alt"></i></div>
                <div class="category-content">
                    <h3>Government Regulations & Permissions</h3>
                    <p>Guidance on permits, licenses and regulatory requirements.</p>
                </div>
            </div>
            
            <div class="category-card" onclick="navigateToCategory('health')">
                <div class="category-icon"><i class="fas fa-heartbeat"></i></div>
                <div class="category-content">
                    <h3>Health & Safety</h3>
                    <p>Healthcare services, safety guidelines and wellness programs.</p>
                </div>
            </div>
            
            <div class="category-card" onclick="navigateToCategory('agriculture')">
                <div class="category-icon"><i class="fas fa-tractor"></i></div>
                <div class="category-content">
                    <h3>Agriculture & Market</h3>
                    <p>Farming techniques, market prices and agricultural support.</p>
                </div>
            </div>
            
            <div class="category-card" onclick="navigateToCategory('welfare')">
                <div class="category-icon"><i class="fas fa-hands-helping"></i></div>
                <div class="category-content">
                    <h3>Social Welfare & Others</h3>
                    <p>Social programs, educational support and community services.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Service Provider Dashboard -->
    <div class="provider-dashboard container" id="providerDashboard">
        <div class="dashboard-header">
            <h2>Service Provider Dashboard</h2>
            <p>Manage your professional profile and respond to bookings</p>
        </div>
        
        <div class="provider-welcome">
            <h2>Welcome, <span id="providerWelcomeName">Provider</span></h2>
            <p>You are logged in as a <span id="providerTypeDisplay">Service Provider</span></p>
        </div>
        
        <div class="provider-info-card">
            <div class="provider-avatar-large">
                <img src="https://ui-avatars.com/api/?name=Provider&background=2e8b57&color=fff" alt="Provider" id="providerDashboardAvatar">
            </div>
            <div class="provider-details">
                <h3 id="providerDashboardName">Provider Name</h3>
                <p id="providerDashboardSpecialization">Specialization</p>
                <p id="providerDashboardLocation">Location</p>
                <p id="providerDashboardContact">Contact Information</p>
                <span class="status-badge" id="providerDashboardStatus">Status</span>
                <p id="providerDashboardBio" style="margin-top: 10px;">Professional bio will appear here</p>
            </div>
        </div>
        
        <div class="provider-tabs">
            <button class="provider-tab active" onclick="switchProviderTab('bookings')">My Bookings</button>
            <button class="provider-tab" onclick="switchProviderTab('profile')">My Profile</button>
            <button class="provider-tab" onclick="switchProviderTab('availability')">Availability</button>
        </div>
        
        <!-- Bookings Tab -->
        <div id="providerBookingsTab" class="tab-content active">
            <div class="form-card">
                <h3>Your Bookings</h3>
                <p>Manage and respond to customer bookings</p>
                
                <table class="provider-bookings-table">
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Service Type</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="providerBookingsTableBody">
                        <!-- Provider bookings will be dynamically added here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Profile Tab -->
        <div id="providerProfileTab" class="tab-content">
            <div class="form-card">
                <h3>Update Your Profile</h3>
                <form id="providerProfileForm" onsubmit="updateProviderProfile(event)" novalidate>
                    <div class="form-group">
                        <label for="updateProviderName">Full Name</label>
                        <input type="text" id="updateProviderName" placeholder="Enter your full name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="updateProviderPhone">Phone Number</label>
                        <input type="tel" id="updateProviderPhone" placeholder="Enter your phone number" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="updateProviderAddress">Address</label>
                        <textarea id="updateProviderAddress" placeholder="Enter your complete address" rows="3" required></textarea>
                    </div>
                    
                    <div id="doctorProfileFields" style="display: none;">
                        <div class="form-group">
                            <label for="updateDoctorHospital">Hospital/Clinic Name</label>
                            <input type="text" id="updateDoctorHospital" placeholder="Name of your hospital or clinic" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="updateDoctorAvailability">Availability</label>
                            <input type="text" id="updateDoctorAvailability" placeholder="e.g., Mon-Fri 9am-5pm, Sat 9am-1pm" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="updateDoctorConsultationFee">Consultation Fee (LKR)</label>
                            <input type="number" id="updateDoctorConsultationFee" placeholder="Fee per consultation" min="0" required>
                        </div>
                    </div>
                    
                    <div id="draftsmanProfileFields" style="display: none;">
                        <div class="form-group">
                            <label for="updateDraftsmanServices">Services Offered</label>
                            <textarea id="updateDraftsmanServices" placeholder="List the services you offer" rows="3" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="updateDraftsmanRate">Service Rate (LKR)</label>
                            <input type="text" id="updateDraftsmanRate" placeholder="e.g., 10,000 per plan or hourly rate" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="updateDraftsmanAvailability">Availability</label>
                            <input type="text" id="updateDraftsmanAvailability" placeholder="e.g., Mon-Fri 9am-5pm, Weekends by appointment" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="updateProviderBio">Professional Bio</label>
                        <textarea id="updateProviderBio" placeholder="Tell us about your professional background and experience" rows="4" required></textarea>
                    </div>
                    
                    <button type="submit" class="submit-btn">Update Profile</button>
                </form>
            </div>
        </div>
        
        <!-- Availability Tab -->
        <div id="providerAvailabilityTab" class="tab-content">
            <div class="form-card">
                <h3>Manage Your Availability</h3>
                <div class="form-group">
                    <label>Current Status: <span id="currentAvailabilityStatus" style="color: #2e8b57; font-weight: bold;">Available</span></label>
                    <div style="margin-top: 15px;">
                        <button type="button" class="submit-btn" onclick="changeAvailabilityStatus('available')" style="background: linear-gradient(to right, #28a745, #20c997); margin-right: 10px;">Mark as Available</button>
                        <button type="button" class="submit-btn" onclick="changeAvailabilityStatus('busy')" style="background: linear-gradient(to right, #ffc107, #ffd54f); margin-right: 10px;">Mark as Busy</button>
                        <button type="button" class="submit-btn" onclick="changeAvailabilityStatus('unavailable')" style="background: linear-gradient(to right, #dc3545, #e35d6a);">Mark as Unavailable</button>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 30px;">
                    <h4>Upcoming Bookings</h4>
                    <div id="providerUpcomingBookings">
                        <!-- Upcoming bookings will be dynamically added here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel container" id="adminPanel">
        <div class="admin-header">
            <h2>Admin Dashboard</h2>
            <p>Manage users, content, and system settings</p>
        </div>
        
        <div class="admin-stats">
            <div class="stat-card">
                <h3>Total Users</h3>
                <div class="number" id="totalUsers">0</div>
            </div>
            
            <div class="stat-card">
                <h3>Problem Submissions</h3>
                <div class="number" id="totalSubmissions">0</div>
            </div>
            
            <div class="stat-card">
                <h3>Resolved Issues</h3>
                <div class="number" id="resolvedIssues">0</div>
            </div>
            
            <div class="stat-card">
                <h3>Service Providers</h3>
                <div class="number" id="totalProviders">0</div>
            </div>
            
            <div class="stat-card">
                <h3>Total Bookings</h3>
                <div class="number" id="totalBookings">0</div>
            </div>
            
            <div class="stat-card">
                <h3>Pending Approvals</h3>
                <div class="number" id="pendingApprovals">0</div>
            </div>
        </div>
        
        <div class="admin-actions">
            <h3>Management Tools</h3>
            <div class="admin-controls">
                <div class="control-card">
                    <h4>User Management</h4>
                    <div class="control-form">
                        <input type="text" id="userSearch" placeholder="Search users..." onkeyup="searchUsers()">
                    </div>
                    <table class="users-list">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="control-card">
                    <h4>Problem Submissions</h4>
                    <table class="submissions-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Category</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="submissionsTableBody">
                            <!-- Submissions will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="control-card">
                    <h4>Service Provider Approvals</h4>
                    <div class="control-form">
                        <input type="text" id="providerSearch" placeholder="Search providers..." onkeyup="searchProviders()">
                    </div>
                    <table class="providers-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="providersTableBody">
                            <!-- Providers will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Bookings Management Section -->
            <div class="news-admin-controls">
                <h3>Bookings Management</h3>
                <div class="admin-controls">
                    <div class="control-card">
                        <h4>All Bookings</h4>
                        <div class="control-form">
                            <input type="text" id="bookingSearch" placeholder="Search bookings..." onkeyup="searchBookings()">
                        </div>
                        <table class="bookings-table">
                            <thead>
                                <tr>
                                    <th>Customer</th>
                                    <th>Provider</th>
                                    <th>Service</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="bookingsTableBody">
                                <!-- Bookings will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- News Management Section -->
            <div class="news-admin-controls">
                <h3>News Management</h3>
                <div class="admin-controls">
                    <div class="control-card">
                        <h4>Add New News Item</h4>
                        <form class="control-form" id="newsForm" onsubmit="addNewsItem(event)" novalidate>
                            <input type="text" id="newsTitle" placeholder="News Title" required>
                            <select id="newsCategory" required>
                                <option value="">Select Category</option>
                                <option value="government">Government Schemes</option>
                                <option value="regulations">Regulations</option>
                                <option value="health">Health & Safety</option>
                                <option value="agriculture">Agriculture</option>
                                <option value="welfare">Social Welfare</option>
                            </select>
                            <textarea id="newsContent" placeholder="News Content" rows="4" required></textarea>
                            <input type="text" id="newsImage" placeholder="Image URL (optional)">
                            <button type="submit">Add News Item</button>
                        </form>
                    </div>
                    
                    <div class="control-card">
                        <h4>Manage News Items</h4>
                        <div class="control-form">
                            <input type="text" id="newsSearch" placeholder="Search news..." onkeyup="searchNews()">
                        </div>
                        <table class="submissions-table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="newsTableBody">
                                <!-- News items will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>LifeBridge Rural Sri Lanka</h3>
                    <p>Bridging Sri Lankan Villages to Resources</p>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#" onclick="showHome()">Home</a></li>
                        <li><a href="#" onclick="showDashboard()">Dashboard</a></li>
                        <li><a href="#" onclick="showServiceProviders()">Service Providers</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Government Partners</h3>
                    <ul>
                        <li><a href="#">Ministry of Rural Economy</a></li>
                        <li><a href="#">Samurdhi Authority</a></li>
                        <li><a href="#">Agrarian Development</a></li>
                        <li><a href="#">Department of Agriculture</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Service Providers</h3>
                    <ul>
                        <li><a href="#" onclick="showProviderSelectionModal()">Register as Provider</a></li>
                        <li><a href="#" onclick="showProviderDashboard()">Provider Login</a></li>
                        <li><a href="#" onclick="showAvailableDoctors()">Find Doctors</a></li>
                        <li><a href="#" onclick="showAvailableDraftsmen()">Find Draftsmen</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2025 LifeBridge Rural Sri Lanka. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript Code - UPDATED VERSION with Buildings.html integration -->
    <script>
        // Pradeshiya Sabha data for Sri Lanka
        const pradeshiyaSabhasData = {
            "Ampara": ["Akkaraipattu", "Ampara", "Dehiattakandiya", "Kalmunai", "Mahaoya", "Padiyatalawa", "Sammanthurai", "Uhana"],
            "Anuradhapura": ["Anuradhapura", "Galenbindunuwewa", "Horowpathana", "Kahatagasdigiliya", "Kekirawa", "Medawachchiya", "Mihintale", "Nochchiyagama", "Padaviya", "Palagala", "Talawa"],
            "Badulla": ["Badulla", "Bandarawela", "Ella", "Haldummulla", "Hali-Ela", "Haputale", "Mahiyanganaya", "Meegahakiula", "Passara", "Welimada"],
            "Batticaloa": ["Eravur Pattu", "Koralai Pattu", "Manmunai", "Porativu Pattu"],
            "Colombo": ["Colombo", "Dehiwala-Mount Lavinia", "Homagama", "Kaduwela", "Kesbewa", "Kolonnawa", "Kotte", "Maharagama", "Moratuwa", "Ratmalana", "Seethawaka"],
            "Galle": ["Akmeemana", "Ambalangoda", "Baddegama", "Bentota", "Bope-Poddala", "Elpitiya", "Galle", "Habaraduwa", "Imaduwa", "Karandeniya", "Nagoda", "Neluwa", "Niyagama", "Thawalama"],
            "Gampaha": ["Attanagalla", "Biyagama", "Divulapitiya", "Dompe", "Gampaha", "Ja-Ela", "Katana", "Kelaniya", "Mahara", "Minuwangoda", "Mirigama", "Negombo", "Wattala"],
            "Hambantota": ["Ambalantota", "Angunakolapelessa", "Beliatta", "Hambantota", "Lunugamvehera", "Sooriyawewa", "Tangalle", "Tissamaharama", "Weeraketiya"],
            "Jaffna": ["Chavakachcheri", "Delft", "Jaffna", "Karainagar", "Kayts", "Nallur", "Point Pedro", "Valikamam", "Velanai"],
            "Kalutara": ["Agalawatta", "Bandaragama", "Beruwala", "Bulathsinhala", "Dodangoda", "Horana", "Kalutara", "Madurawela", "Matugama", "Panadura", "Walallawita"],
            "Kandy": ["Akurana", "Gangawata Korale", "Harispattuwa", "Kandy", "Kundasale", "Meda Dumbara", "Minipe", "Panvila", "Pasbage Korale", "Pathadumbara", "Poojapitiya", "Thumpane", "Uda Palatha", "Udunuwara", "Yatinuwara"],
            "Kegalle": ["Aranayake", "Bulathkohupitiya", "Dehiowita", "Deraniyagala", "Galigamuwa", "Kegalle", "Mawanella", "Rambukkana", "Ruwanwella", "Warakapola", "Yatiyantota"],
            "Kilinochchi": ["Karachchi", "Pachchilaipalli", "Poonakary"],
            "Kurunegala": ["Alawwa", "Bingiriya", "Galgamuwa", "Giribawa", "Ibbagamuwa", "Kobeigane", "Kuliyapitiya", "Kurunegala", "Mawathagama", "Narammala", "Nikaweratiya", "Panduwasnuwara", "Polgahawela", "Polpithigama", "Wariyapola"],
            "Mannar": ["Mannar", "Manthai West", "Musali", "Nanaddan"],
            "Matale": ["Ambanganga Korale", "Dambulla", "Galewela", "Laggala-Pallegama", "Matale", "Naula", "Pallepola", "Rattota", "Ukuwela", "Wilgamuwa", "Yatawatta"],
            "Matara": ["Akuressa", "Athuraliya", "Devinuwara", "Dickwella", "Hakmana", "Kamburupitiya", "Kirinda Puhulwella", "Kotapola", "Malimbada", "Matara", "Mulatiyana", "Pasgoda", "Pitabeddara", "Thihagoda", "Weligama"],
            "Moneragala": ["Badalkumbura", "Bibile", "Buttala", "Kataragama", "Madulla", "Medagama", "Moneragala", "Siyambalanduwa", "Thanamalvila", "Wellawaya"],
            "Mullaitivu": ["Manthai East", "Maritimepattu", "Puthukudiyiruppu", "Thunukkai"],
            "Nuwara Eliya": ["Ambagamuwa", "Hanguranketha", "Kothmale", "Nuwara Eliya", "Walapane"],
            "Polonnaruwa": ["Dimbulagala", "Elahera", "Hingurakgoda", "Lankapura", "Medirigiriya", "Polonnaruwa", "Welikanda"],
            "Puttalam": ["Anamaduwa", "Arachchikattuwa", "Chilaw", "Kalpitiya", "Karuwalagaswewa", "Nattandiya", "Nawagattegama", "Puttalam", "Wennappuwa"],
            "Ratnapura": ["Ayagama", "Balangoda", "Eheliyagoda", "Elapattha", "Embilipitiya", "Godakawela", "Imbulpe", "Kahawatta", "Kalawana", "Kolonna", "Kuruwita", "Nivithigala", "Opanayaka", "Pelmadulla", "Ratnapura", "Weligepola"],
            "Trincomalee": ["Gomarankadawala", "Kantalai", "Kinniya", "Kuchchaveli", "Morawewa", "Muttur", "Padavi Sri Pura", "Seruwila", "Thambalagamuwa", "Trincomalee"],
            "Vavuniya": ["Vavuniya", "Vavuniya North", "Vavuniya South", "Vengalacheddikulam"]
        };

        // Initialize sample data - UPDATED WITH PRADESHIYA SABHA
        function initializeData() {
            // Initialize users if not exists
            if (!localStorage.getItem('users')) {
                const users = [
                    { 
                        id: 1, 
                        name: 'Admin User', 
                        email: 'admin@lifebridgelk.lk', 
                        password: 'admin123', 
                        role: 'admin',
                        profilePicture: 'https://i.ibb.co/0Q8Zz9X/lifebridge-logo.png',
                        joinDate: '2025-01-15',
                        status: 'Active',
                        phone: '+94 11 234 5678',
                        address: '123 Admin Street, Colombo',
                        district: 'colombo',
                        pradeshiyaSabha: 'Colombo'
                    },
                    { 
                        id: 2, 
                        name: 'John Doe', 
                        email: 'john@example.com', 
                        password: 'user123', 
                        role: 'user',
                        profilePicture: 'https://ui-avatars.com/api/?name=John+Doe&background=2e8b57&color=fff',
                        joinDate: '2025-09-01',
                        status: 'Active',
                        phone: '+94 77 123 4567',
                        address: '456 Rural Road, Ampara',
                        district: 'ampara',
                        pradeshiyaSabha: 'Ampara'
                    }
                ];
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            // Initialize submissions if not exists
            if (!localStorage.getItem('submissions')) {
                const submissions = [
                    { 
                        id: 1, 
                        userId: 2, 
                        userName: 'John Doe',
                        userEmail: 'john@example.com',
                        category: 'agriculture', 
                        title: 'Need assistance with fertilizer subsidy',
                        description: 'I am a small-scale farmer struggling to access the government fertilizer subsidy program. The application process is complicated and I need guidance.',
                        location: 'Ampara District',
                        contact: '0712345678',
                        date: '2025-09-16',
                        status: 'Pending'
                    }
                ];
                localStorage.setItem('submissions', JSON.stringify(submissions));
            }
            
            // Initialize news if not exists
            if (!localStorage.getItem('news')) {
                const news = [
                    { 
                        id: 2, 
                        title: 'New Government Scheme for Rural Farmers', 
                        category: 'government',
                        content: 'The government has launched a new financial aid program for small-scale farmers in rural areas. The program offers subsidies for equipment and training.\n\nApplications for the program will be accepted starting next month through local agricultural offices. Farmers can receive up to 50% subsidy on approved equipment purchases and access free training sessions on modern farming techniques.',
                        image: 'https://images.unsplash.com/photo-1625246335526-18cd7a16752f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80',
                        date: '2025-09-15',
                        author: 'Admin'
                    },
                    { 
                        id: 1, 
                        title: 'Health Awareness Campaign in Rural Areas', 
                        category: 'health',
                        content: 'A new health awareness campaign focusing on CKDu prevention will be launched in rural districts next month. Free health screenings will be available.\n\nThe campaign will visit 15 districts over the next six months, providing free medical checkups and education about Chronic Kidney Disease of unknown etiology (CKDu). Mobile clinics will be set up in rural villages to make healthcare more accessible to remote communities.',
                        image: 'https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80',
                        date: '2025-09-10',
                        author: 'Admin'
                    }
                ];
                localStorage.setItem('news', JSON.stringify(news));
            }
            
            // Initialize service providers if not exists - UPDATED WITH PRADESHIYA SABHA
            if (!localStorage.getItem('serviceProviders')) {
                const providers = [
                    {
                        id: 1,
                        type: 'doctor',
                        name: 'Dr. Priya Fernando',
                        email: 'drpriya@example.com',
                        password: 'doctor123',
                        phone: '011-2345678',
                        address: '123 Medical Street, Colombo',
                        district: 'colombo',
                        pradeshiyaSabha: 'Colombo',
                        specialization: 'general',
                        qualification: 'MBBS, MD',
                        registrationNo: 'SLMC-12345',
                        experience: 12,
                        hospital: 'Colombo General Hospital',
                        availability: 'Mon-Fri 9am-5pm, Sat 9am-1pm',
                        consultationFee: 1500,
                        bio: 'Experienced general practitioner with expertise in rural healthcare. Special interest in preventive medicine and community health.',
                        profilePicture: 'https://randomuser.me/api/portraits/women/44.jpg',
                        status: 'approved',
                        availabilityStatus: 'available',
                        joinDate: '2025-01-10'
                    },
                    {
                        id: 2,
                        type: 'draftsman',
                        name: 'Mr. Anura Perera',
                        email: 'anura.draftsman@example.com',
                        password: 'draftsman123',
                        phone: '077-9876543',
                        address: '456 Design Road, Kandy',
                        district: 'kandy',
                        pradeshiyaSabha: 'Kandy',
                        qualification: 'Diploma in Architectural Drafting',
                        registrationNo: 'IDC-54321',
                        experience: 8,
                        services: 'House plans, site plans, renovation plans, commercial building designs',
                        rate: '10,000 - 50,000 LKR per project',
                        availability: 'Mon-Fri 9am-5pm, Weekends by appointment',
                        bio: 'Professional draftsman with 8 years of experience in residential and commercial projects. Specialized in traditional and modern Sri Lankan architecture.',
                        profilePicture: 'https://randomuser.me/api/portraits/men/67.jpg',
                        status: 'approved',
                        availabilityStatus: 'available',
                        joinDate: '2025-02-15'
                    },
                    {
                        id: 3,
                        type: 'draftsman',
                        name: 'Mr. Rajan Sivarajah',
                        email: 'rajan.draftsman@example.com',
                        password: 'draftsman456',
                        phone: '021-1234567',
                        address: '123 Drafting Street, Jaffna',
                        district: 'jaffna',
                        pradeshiyaSabha: 'Jaffna',
                        qualification: 'B.Sc. in Architectural Technology',
                        registrationNo: 'IDC-98765',
                        experience: 10,
                        services: 'Residential buildings, commercial complexes, interior design',
                        rate: '15,000 - 75,000 LKR per project',
                        availability: 'Mon-Sat 9am-6pm',
                        bio: 'Experienced draftsman with expertise in modern architectural designs and sustainable building solutions.',
                        profilePicture: 'https://randomuser.me/api/portraits/men/45.jpg',
                        status: 'approved',
                        availabilityStatus: 'available',
                        joinDate: '2025-03-10'
                    },
                    {
                        id: 4,
                        type: 'doctor',
                        name: 'Dr. Rajesh Kumar',
                        email: 'drrajesh@example.com',
                        password: 'doctor456',
                        phone: '081-2345678',
                        address: '789 Health Lane, Kandy',
                        district: 'kandy',
                        pradeshiyaSabha: 'Kandy',
                        specialization: 'pediatrics',
                        qualification: 'MBBS, DCH',
                        registrationNo: 'SLMC-67890',
                        experience: 8,
                        hospital: 'Kandy Children\'s Hospital',
                        availability: 'Mon-Sat 8am-4pm',
                        consultationFee: 1200,
                        bio: 'Specialized in child healthcare with focus on preventive medicine. Experienced in rural pediatric care.',
                        profilePicture: 'https://randomuser.me/api/portraits/men/32.jpg',
                        status: 'pending',
                        availabilityStatus: 'available',
                        joinDate: '2025-09-01'
                    }
                ];
                localStorage.setItem('serviceProviders', JSON.stringify(providers));
            }
            
            // Initialize bookings if not exists - INCLUDING BUILDINGS.HTML BOOKINGS
            if (!localStorage.getItem('bookings')) {
                const bookings = [
                    {
                        id: 1,
                        type: 'doctor',
                        providerId: 1,
                        providerName: 'Dr. Priya Fernando',
                        userId: 2,
                        userName: 'John Doe',
                        userEmail: 'john@example.com',
                        patientName: 'John Doe',
                        patientAge: 35,
                        patientGender: 'male',
                        medicalIssue: 'Persistent cough and fever for 5 days',
                        preferredDate: '2025-09-20',
                        preferredTime: '10:00',
                        contact: '0712345678',
                        notes: 'No known allergies',
                        status: 'confirmed',
                        providerResponse: '',
                        responseDate: '',
                        bookingDate: '2025-09-16'
                    },
                    {
                        id: 2,
                        type: 'draftsman',
                        providerId: 2,
                        providerName: 'Mr. Anura Perera',
                        userId: 2,
                        userName: 'John Doe',
                        userEmail: 'john@example.com',
                        clientName: 'John Doe',
                        projectType: 'house',
                        projectDetails: 'Need a house plan for a 2-story, 3-bedroom house on a 10-perch land',
                        propertyAddress: '456 Rural Road, Ampara',
                        propertySize: 10,
                        preferredVisitDate: '2025-09-25',
                        contact: '0712345678',
                        budget: 25000,
                        status: 'pending',
                        providerResponse: '',
                        responseDate: '',
                        bookingDate: '2025-09-17'
                    }
                ];
                localStorage.setItem('bookings', JSON.stringify(bookings));
            }
            
            updateUserInterface();
            updateStats();
            loadUsersTable();
            loadSubmissionsTable();
            loadProvidersTable();
            loadBookingsTable();
            loadNewsTable();
            displayNews('all');
            setupNewsFilters();
            loadAvailableProviders();
        }
        
        // Update user interface based on login status
        function updateUserInterface() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            const currentProvider = JSON.parse(localStorage.getItem('currentProvider') || 'null');
            const authButton = document.getElementById('authButton');
            const userProfileSection = document.getElementById('userProfileSection');
            const userName = document.getElementById('userName');
            const userAvatar = document.getElementById('userAvatar');
            
            if (currentUser) {
                // Regular user is logged in
                authButton.textContent = 'Logout';
                authButton.onclick = handleLogout;
                
                // Show user profile
                userProfileSection.style.display = 'flex';
                userName.textContent = currentUser.name;
                
                // Set user avatar
                userAvatar.src = currentUser.profilePicture || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(currentUser.name) + '&background=2e8b57&color=fff';
                
                // Update profile section if on dashboard
                if (document.getElementById('userDashboard').style.display === 'block') {
                    loadPersonalInfoForm(currentUser);
                    loadUserBookings();
                }
            } else if (currentProvider) {
                // Service provider is logged in
                authButton.textContent = 'Logout';
                authButton.onclick = handleProviderLogout;
                
                // Show provider profile
                userProfileSection.style.display = 'flex';
                userName.textContent = currentProvider.name;
                
                // Set provider avatar
                userAvatar.src = currentProvider.profilePicture || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(currentProvider.name) + '&background=2e8b57&color=fff';
                
                // Update provider dashboard if visible
                if (document.getElementById('providerDashboard').style.display === 'block') {
                    loadProviderDashboard(currentProvider);
                }
            } else {
                // No one is logged in
                authButton.textContent = 'Login';
                authButton.onclick = showLoginModal;
                userProfileSection.style.display = 'none';
            }
        }
        
        // Load personal info form with user data
        function loadPersonalInfoForm(user) {
            document.getElementById('personalName').value = user.name || '';
            document.getElementById('personalEmail').value = user.email || '';
            document.getElementById('personalPhone').value = user.phone || '';
            document.getElementById('personalAddress').value = user.address || '';
            document.getElementById('personalDistrict').value = user.district || '';
            document.getElementById('personalPradeshiyaSabha').value = user.pradeshiyaSabha || '';
        }
        
        // Update personal information
        function updatePersonalInfo(event) {
            event.preventDefault();
            
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (!currentUser) {
                alert('Please login to update your information');
                showLoginModal();
                return;
            }
            
            const name = document.getElementById('personalName').value;
            const email = document.getElementById('personalEmail').value;
            const phone = document.getElementById('personalPhone').value;
            const address = document.getElementById('personalAddress').value;
            const district = document.getElementById('personalDistrict').value;
            const pradeshiyaSabha = document.getElementById('personalPradeshiyaSabha').value;
            
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            if (userIndex !== -1) {
                users[userIndex].name = name;
                users[userIndex].email = email;
                users[userIndex].phone = phone;
                users[userIndex].address = address;
                users[userIndex].district = district;
                users[userIndex].pradeshiyaSabha = pradeshiyaSabha;
                
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('currentUser', JSON.stringify(users[userIndex]));
                
                // Update UI
                document.getElementById('userName').textContent = name;
                updateUserInterface();
                
                alert('Your personal information has been updated successfully!');
            }
        }
        
        // Load user bookings
        function loadUserBookings() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (!currentUser) return;
            
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            
            // Get bookings from this user (by email or user ID)
            const userBookings = bookings.filter(b => 
                b.userEmail === currentUser.email || 
                b.userId === currentUser.id ||
                (b.userId && b.userId.toString().includes('temp_user_') && b.userName === currentUser.name)
            );
            
            const bookingsList = document.getElementById('userBookingsList');
            
            if (userBookings.length === 0) {
                bookingsList.innerHTML = '<p>You have no bookings yet.</p>';
                return;
            }
            
            let html = '<table class="provider-bookings-table"><thead><tr><th>Service</th><th>Provider</th><th>Date</th><th>Status</th><th>Actions</th></tr></thead><tbody>';
            
            userBookings.forEach(booking => {
                const serviceType = booking.type === 'doctor' ? 'Doctor Appointment' : 'Draftsman Service';
                const statusClass = booking.status === 'confirmed' ? 'status-approved' : 
                                   booking.status === 'pending' ? 'status-pending' : 
                                   booking.status === 'completed' ? 'status-completed' : 'status-rejected';
                
                html += `
                    <tr>
                        <td>${serviceType}</td>
                        <td>${booking.providerName}</td>
                        <td>${booking.preferredDate || booking.bookingDate}</td>
                        <td><span class="status-badge ${statusClass}">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span></td>
                        <td>
                            <button class="action-btn view-btn" onclick="viewUserBooking(${booking.id})">View</button>
                            ${booking.providerResponse ? `<button class="action-btn reply-btn" onclick="viewProviderResponse(${booking.id})">Response</button>` : ''}
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            bookingsList.innerHTML = html;
        }
        
        // View user booking
        function viewUserBooking(id) {
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const booking = bookings.find(b => b.id === id);
            
            if (booking) {
                let details = '';
                
                if (booking.type === 'doctor') {
                    details = `
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Service Type:</span>
                            <span class="submission-detail-value">Doctor Appointment</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Doctor:</span>
                            <span class="submission-detail-value">${booking.providerName}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Patient Name:</span>
                            <span class="submission-detail-value">${booking.patientName}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Patient Age:</span>
                            <span class="submission-detail-value">${booking.patientAge}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Patient Gender:</span>
                            <span class="submission-detail-value">${booking.patientGender}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Medical Issue:</span>
                            <span class="submission-detail-value">${booking.medicalIssue}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Preferred Date:</span>
                            <span class="submission-detail-value">${booking.preferredDate}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Preferred Time:</span>
                            <span class="submission-detail-value">${booking.preferredTime}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Contact:</span>
                            <span class="submission-detail-value">${booking.contact}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Notes:</span>
                            <span class="submission-detail-value">${booking.notes || 'None'}</span>
                        </div>
                    `;
                } else {
                    details = `
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Service Type:</span>
                            <span class="submission-detail-value">Draftsman Service</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Draftsman:</span>
                            <span class="submission-detail-value">${booking.providerName}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Client Name:</span>
                            <span class="submission-detail-value">${booking.clientName}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Project Type:</span>
                            <span class="submission-detail-value">${booking.projectType}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Project Details:</span>
                            <span class="submission-detail-value">${booking.projectDetails}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Property Address:</span>
                            <span class="submission-detail-value">${booking.propertyAddress}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Property Size:</span>
                            <span class="submission-detail-value">${booking.propertySize} perches</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Preferred Visit Date:</span>
                            <span class="submission-detail-value">${booking.preferredVisitDate}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Contact:</span>
                            <span class="submission-detail-value">${booking.contact}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Budget:</span>
                            <span class="submission-detail-value">LKR ${booking.budget}</span>
                        </div>
                    `;
                }
                
                details += `
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Status:</span>
                        <span class="submission-detail-value">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Booking Date:</span>
                        <span class="submission-detail-value">${booking.bookingDate}</span>
                    </div>
                `;
                
                document.getElementById('bookingDetailsTitle').textContent = 'Booking Details';
                document.getElementById('bookingDetailsContent').innerHTML = details;
                document.getElementById('responseSection').style.display = 'none';
                document.getElementById('bookingDetailsModal').style.display = 'flex';
            }
        }
        
        // View provider response
        function viewProviderResponse(id) {
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const booking = bookings.find(b => b.id === id);
            
            if (booking && booking.providerResponse) {
                const detailsContainer = document.getElementById('responseDetails');
                detailsContainer.innerHTML = `
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Booking ID:</span>
                        <span class="submission-detail-value">${booking.id}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Service:</span>
                        <span class="submission-detail-value">${booking.type === 'doctor' ? 'Doctor Appointment' : 'Draftsman Service'}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Provider:</span>
                        <span class="submission-detail-value">${booking.providerName}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Response Date:</span>
                        <span class="submission-detail-value">${booking.responseDate || 'Not specified'}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Provider's Response:</span>
                        <span class="submission-detail-value">${booking.providerResponse}</span>
                    </div>
                `;
                
                document.getElementById('responseModal').style.display = 'flex';
            } else {
                alert('No response from provider yet.');
            }
        }
        
        // Update admin statistics
        function updateStats() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const submissions = JSON.parse(localStorage.getItem('submissions') || '[]');
            const news = JSON.parse(localStorage.getItem('news') || '[]');
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
            const resolved = submissions.filter(s => s.status === 'Resolved').length;
            const pendingProviders = providers.filter(p => p.status === 'pending').length;
            
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalSubmissions').textContent = submissions.length;
            document.getElementById('resolvedIssues').textContent = resolved;
            document.getElementById('totalProviders').textContent = providers.length;
            document.getElementById('totalBookings').textContent = bookings.length;
            document.getElementById('pendingApprovals').textContent = pendingProviders;
        }
        
        // Load users table
        function loadUsersTable() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const tableBody = document.getElementById('usersTableBody');
            tableBody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.role}</td>
                    <td>${user.status}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editUser(${user.id})">Edit</button>
                        <button class="action-btn delete-btn" onclick="deleteUser(${user.id})">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // Search users
        function searchUsers() {
            const searchText = document.getElementById('userSearch').value.toLowerCase();
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const tableBody = document.getElementById('usersTableBody');
            tableBody.innerHTML = '';
            
            const filteredUsers = users.filter(user => 
                user.name.toLowerCase().includes(searchText) || 
                user.email.toLowerCase().includes(searchText)
            );
            
            filteredUsers.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.role}</td>
                    <td>${user.status}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editUser(${user.id})">Edit</button>
                        <button class="action-btn delete-btn" onclick="deleteUser(${user.id})">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // Load submissions table
        function loadSubmissionsTable() {
            const submissions = JSON.parse(localStorage.getItem('submissions') || '[]');
            const tableBody = document.getElementById('submissionsTableBody');
            tableBody.innerHTML = '';
            
            const categoryNames = {
                'government': 'Government Schemes',
                'regulations': 'Government Regulations',
                'health': 'Health & Safety',
                'agriculture': 'Agriculture & Market',
                'welfare': 'Social Welfare'
            };
            
            submissions.forEach(submission => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${submission.userName}</td>
                    <td>${categoryNames[submission.category]}</td>
                    <td>${submission.date}</td>
                    <td>${submission.status}</td>
                    <td>
                        <button class="action-btn view-btn" onclick="viewSubmission(${submission.id})">View</button>
                        <button class="action-btn delete-btn" onclick="deleteSubmission(${submission.id})">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // View submission details
        function viewSubmission(id) {
            const submissions = JSON.parse(localStorage.getItem('submissions') || '[]');
            const submission = submissions.find(s => s.id === id);
            
            if (submission) {
                const categoryNames = {
                    'government': 'Government Schemes',
                    'regulations': 'Government Regulations',
                    'health': 'Health & Safety',
                    'agriculture': 'Agriculture & Market',
                    'welfare': 'Social Welfare'
                };
                
                const detailsContainer = document.getElementById('submissionDetails');
                detailsContainer.innerHTML = `
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">User Name:</span>
                        <span class="submission-detail-value">${submission.userName}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">User Email:</span>
                        <span class="submission-detail-value">${submission.userEmail}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Category:</span>
                        <span class="submission-detail-value">${categoryNames[submission.category]}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Title:</span>
                        <span class="submission-detail-value">${submission.title}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Description:</span>
                        <span class="submission-detail-value">${submission.description}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Location:</span>
                        <span class="submission-detail-value">${submission.location}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Contact:</span>
                        <span class="submission-detail-value">${submission.contact}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Date Submitted:</span>
                        <span class="submission-detail-value">${submission.date}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Status:</span>
                        <span class="submission-detail-value">${submission.status}</span>
                    </div>
                `;
                
                document.getElementById('submissionModal').style.display = 'flex';
            }
        }
        
        // Close submission modal
        function closeSubmissionModal() {
            document.getElementById('submissionModal').style.display = 'none';
        }
        
        // Delete submission
        function deleteSubmission(id) {
            if (confirm('Are you sure you want to delete this submission?')) {
                let submissions = JSON.parse(localStorage.getItem('submissions') || '[]');
                submissions = submissions.filter(s => s.id !== id);
                localStorage.setItem('submissions', JSON.stringify(submissions));
                loadSubmissionsTable();
                updateStats();
                alert('Submission deleted successfully!');
            }
        }
        
        // Submit problem form
        function submitProblemForm(event) {
            event.preventDefault();
            
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (!currentUser) {
                alert('Please login to submit a problem');
                showLoginModal();
                return;
            }
            
            const category = document.getElementById('problemCategory').value;
            const title = document.getElementById('problemTitle').value;
            const description = document.getElementById('problemDescription').value;
            const location = document.getElementById('problemLocation').value;
            const contact = document.getElementById('problemContact').value;
            
            const submissions = JSON.parse(localStorage.getItem('submissions') || '[]');
            const newId = submissions.length > 0 ? Math.max(...submissions.map(s => s.id)) + 1 : 1;
            
            submissions.push({
                id: newId,
                userId: currentUser.id,
                userName: currentUser.name,
                userEmail: currentUser.email,
                category,
                title,
                description,
                location,
                contact,
                date: new Date().toISOString().split('T')[0],
                status: 'Pending'
            });
            
            localStorage.setItem('submissions', JSON.stringify(submissions));
            
            // Clear form
            document.getElementById('problemForm').reset();
            
            alert('Your problem has been submitted successfully! Our team will contact you soon.');
            
            // If admin is viewing, update the submissions table
            if (document.getElementById('adminPanel').style.display === 'block') {
                loadSubmissionsTable();
                updateStats();
            }
        }
        
        // Edit user
        function editUser(id) {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.id === id);
            
            if (user) {
                const newName = prompt('Enter new name:', user.name);
                if (newName !== null) {
                    user.name = newName;
                    localStorage.setItem('users', JSON.stringify(users));
                    loadUsersTable();
                    alert('User updated successfully!');
                }
            }
        }
        
        // Delete user
        function deleteUser(id) {
            if (confirm('Are you sure you want to delete this user?')) {
                let users = JSON.parse(localStorage.getItem('users') || '[]');
                users = users.filter(u => u.id !== id);
                localStorage.setItem('users', JSON.stringify(users));
                loadUsersTable();
                updateStats();
                alert('User deleted successfully!');
            }
        }
        
        // Show login modal
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
            document.getElementById('signupModal').style.display = 'none';
            document.getElementById('providerSelectionModal').style.display = 'none';
            document.getElementById('providerRegistrationModal').style.display = 'none';
        }
        
        // Show signup modal
        function showSignupModal() {
            document.getElementById('signupModal').style.display = 'flex';
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('providerSelectionModal').style.display = 'none';
            document.getElementById('providerRegistrationModal').style.display = 'none';
            
            // Setup profile picture preview
            const profilePictureInput = document.getElementById('profilePicture');
            const profilePreview = document.getElementById('profilePreview');
            
            profilePictureInput.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        profilePreview.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };
        }
        
        // Show provider selection modal
        function showProviderSelectionModal() {
            document.getElementById('providerSelectionModal').style.display = 'flex';
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('signupModal').style.display = 'none';
            document.getElementById('providerRegistrationModal').style.display = 'none';
        }
        
        // Show provider registration form - UPDATED WITH PRADESHIYA SABHA
        function showProviderRegistrationForm(type) {
            console.log('Showing provider registration form for:', type);
            
            document.getElementById('providerRegistrationModal').style.display = 'flex';
            document.getElementById('providerSelectionModal').style.display = 'none';
            
            const providerType = document.getElementById('providerType');
            const doctorFields = document.getElementById('doctorFields');
            const draftsmanFields = document.getElementById('draftsmanFields');
            const formTitle = document.getElementById('providerFormTitle');
            const formSubtitle = document.getElementById('providerFormSubtitle');
            
            providerType.value = type;
            
            if (type === 'doctor') {
                doctorFields.style.display = 'block';
                draftsmanFields.style.display = 'none';
                formTitle.textContent = 'Register as a Doctor';
                formSubtitle.textContent = 'Please provide your professional medical details';
            } else if (type === 'draftsman') {
                doctorFields.style.display = 'none';
                draftsmanFields.style.display = 'block';
                formTitle.textContent = 'Register as a Draftsman';
                formSubtitle.textContent = 'Please provide your professional drafting details';
            }
            
            // Setup profile picture preview
            const profilePictureInput = document.getElementById('providerProfilePicture');
            const profilePreview = document.getElementById('providerProfilePreview');
            
            profilePictureInput.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        profilePreview.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };
            
            // Reset form
            document.getElementById('providerRegistrationForm').reset();
            document.getElementById('providerProfilePreview').src = 'https://ui-avatars.com/api/?name=Provider&background=2e8b57&color=fff';
            document.getElementById('providerPradeshiyaSabha').innerHTML = '<option value="">Select Pradeshiya Sabha</option>';
        }
        
        // Load Pradeshiya Sabhas for provider registration
        function loadPradeshiyaSabhasForProvider() {
            const district = document.getElementById('providerDistrict').value;
            const pradeshiyaSabhaSelect = document.getElementById('providerPradeshiyaSabha');
            
            // Clear previous options
            pradeshiyaSabhaSelect.innerHTML = '<option value="">Select Pradeshiya Sabha</option>';
            
            if (district && pradeshiyaSabhasData[district]) {
                pradeshiyaSabhasData[district].forEach(sabha => {
                    const option = document.createElement("option");
                    option.value = sabha;
                    option.textContent = sabha;
                    pradeshiyaSabhaSelect.appendChild(option);
                });
            } else {
                // If district not in our data, allow manual entry
                const option = document.createElement("option");
                option.value = "other";
                option.textContent = "Other (Please specify)";
                pradeshiyaSabhaSelect.appendChild(option);
            }
        }
        
        // Close auth modal
        function closeAuthModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('signupModal').style.display = 'none';
        }
        
        // Close provider modal
        function closeProviderModal() {
            document.getElementById('providerSelectionModal').style.display = 'none';
        }
        
        // Close provider registration modal
        function closeProviderRegistrationModal() {
            document.getElementById('providerRegistrationModal').style.display = 'none';
        }
        
        // Show home page
        function showHome() {
            document.getElementById('homeContent').style.display = 'block';
            document.getElementById('userDashboard').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('providerDashboard').style.display = 'none';
            updateUserInterface();
        }
        
        // Show service providers section
        function showServiceProviders() {
            showHome();
            // Scroll to service providers section
            document.getElementById('serviceProvidersSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Show user dashboard
        function showDashboard() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            const currentProvider = JSON.parse(localStorage.getItem('currentProvider') || 'null');
            
            if (currentProvider) {
                // If provider is logged in, show provider dashboard instead
                showProviderDashboard();
                return;
            }
            
            if (!currentUser) {
                alert('Please login first to access the dashboard');
                showLoginModal();
                return;
            }
            
            document.getElementById('homeContent').style.display = 'none';
            document.getElementById('userDashboard').style.display = 'block';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('providerDashboard').style.display = 'none';
            
            // Load personal info form
            loadPersonalInfoForm(currentUser);
            loadUserBookings();
        }
        
        // Show provider dashboard
        function showProviderDashboard() {
            const currentProvider = JSON.parse(localStorage.getItem('currentProvider') || 'null');
            
            if (!currentProvider) {
                alert('Please login as a service provider first');
                showLoginModal();
                return;
            }
            
            document.getElementById('homeContent').style.display = 'none';
            document.getElementById('userDashboard').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('providerDashboard').style.display = 'block';
            
            // Load provider dashboard
            loadProviderDashboard(currentProvider);
        }
        
        // Load provider dashboard
        function loadProviderDashboard(provider) {
            // Update welcome section
            document.getElementById('providerWelcomeName').textContent = provider.name;
            document.getElementById('providerTypeDisplay').textContent = provider.type === 'doctor' ? 'Doctor' : 'Draftsman';
            
            // Update provider info card
            document.getElementById('providerDashboardName').textContent = provider.name;
            document.getElementById('providerDashboardAvatar').src = provider.profilePicture || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(provider.name) + '&background=2e8b57&color=fff';
            
            if (provider.type === 'doctor') {
                document.getElementById('providerDashboardSpecialization').textContent = `Specialization: ${getSpecializationName(provider.specialization)}`;
                document.getElementById('providerDashboardLocation').textContent = `Hospital: ${provider.hospital}`;
                document.getElementById('providerDashboardContact').textContent = `Contact: ${provider.phone} | Fee: LKR ${provider.consultationFee}`;
            } else {
                document.getElementById('providerDashboardSpecialization').textContent = `Services: ${provider.services ? provider.services.substring(0, 50) + '...' : 'General Drafting'}`;
                document.getElementById('providerDashboardLocation').textContent = `Location: ${provider.pradeshiyaSabha || provider.district}`;
                document.getElementById('providerDashboardContact').textContent = `Contact: ${provider.phone} | Rate: ${provider.rate || 'Contact for rates'}`;
            }
            
            // Update status badge
            const statusBadge = document.getElementById('providerDashboardStatus');
            statusBadge.textContent = provider.status.charAt(0).toUpperCase() + provider.status.slice(1);
            statusBadge.className = 'status-badge ' + (provider.status === 'approved' ? 'status-approved' : 
                                                      provider.status === 'pending' ? 'status-pending' : 'status-rejected');
            
            // Update bio
            document.getElementById('providerDashboardBio').textContent = provider.bio;
            
            // Load provider bookings
            loadProviderBookings(provider.id);
            
            // Load provider profile form
            loadProviderProfileForm(provider);
            
            // Load availability
            document.getElementById('currentAvailabilityStatus').textContent = provider.availabilityStatus || 'available';
            loadUpcomingBookings(provider.id);
        }
        
        // Load provider bookings
        function loadProviderBookings(providerId) {
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const providerBookings = bookings.filter(b => b.providerId === providerId);
            const tableBody = document.getElementById('providerBookingsTableBody');
            tableBody.innerHTML = '';
            
            if (providerBookings.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No bookings yet.</td></tr>';
                return;
            }
            
            // Sort by date (newest first)
            providerBookings.sort((a, b) => new Date(b.bookingDate) - new Date(a.bookingDate));
            
            providerBookings.forEach(booking => {
                const serviceType = booking.type === 'doctor' ? 'Doctor Appointment' : 'Draftsman Service';
                const statusClass = booking.status === 'confirmed' ? 'status-approved' : 
                                   booking.status === 'pending' ? 'status-pending' : 
                                   booking.status === 'completed' ? 'status-completed' : 'status-rejected';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${booking.userName}</td>
                    <td>${serviceType}</td>
                    <td>${booking.preferredDate || booking.bookingDate}</td>
                    <td><span class="status-badge ${statusClass}">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span></td>
                    <td>
                        <button class="action-btn view-btn" onclick="viewProviderBooking(${booking.id})">View</button>
                        ${booking.status === 'pending' || booking.status === 'confirmed' ? `<button class="action-btn reply-btn" onclick="respondToBooking(${booking.id})">Respond</button>` : ''}
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // Load provider profile form
        function loadProviderProfileForm(provider) {
            document.getElementById('updateProviderName').value = provider.name || '';
            document.getElementById('updateProviderPhone').value = provider.phone || '';
            document.getElementById('updateProviderAddress').value = provider.address || '';
            document.getElementById('updateProviderBio').value = provider.bio || '';
            
            if (provider.type === 'doctor') {
                document.getElementById('doctorProfileFields').style.display = 'block';
                document.getElementById('draftsmanProfileFields').style.display = 'none';
                document.getElementById('updateDoctorHospital').value = provider.hospital || '';
                document.getElementById('updateDoctorAvailability').value = provider.availability || '';
                document.getElementById('updateDoctorConsultationFee').value = provider.consultationFee || '';
            } else {
                document.getElementById('doctorProfileFields').style.display = 'none';
                document.getElementById('draftsmanProfileFields').style.display = 'block';
                document.getElementById('updateDraftsmanServices').value = provider.services || '';
                document.getElementById('updateDraftsmanRate').value = provider.rate || '';
                document.getElementById('updateDraftsmanAvailability').value = provider.availability || '';
            }
        }
        
        // Load upcoming bookings for provider
        function loadUpcomingBookings(providerId) {
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const providerBookings = bookings.filter(b => b.providerId === providerId && (b.status === 'confirmed' || b.status === 'pending'));
            const upcomingBookingsDiv = document.getElementById('providerUpcomingBookings');
            
            if (providerBookings.length === 0) {
                upcomingBookingsDiv.innerHTML = '<p>No upcoming bookings.</p>';
                return;
            }
            
            // Sort by date
            providerBookings.sort((a, b) => new Date(a.preferredDate || a.bookingDate) - new Date(b.preferredDate || b.bookingDate));
            
            let html = '<table class="provider-bookings-table" style="font-size: 0.9rem;"><thead><tr><th>Customer</th><th>Date</th><th>Time</th><th>Status</th></tr></thead><tbody>';
            
            providerBookings.forEach(booking => {
                html += `
                    <tr>
                        <td>${booking.userName}</td>
                        <td>${booking.preferredDate || booking.bookingDate}</td>
                        <td>${booking.preferredTime || 'N/A'}</td>
                        <td><span class="status-badge ${booking.status === 'confirmed' ? 'status-approved' : 'status-pending'}">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span></td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            upcomingBookingsDiv.innerHTML = html;
        }
        
        // Switch provider tab
        function switchProviderTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.provider-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Activate selected tab
            document.querySelector(`.provider-tab[onclick*="${tabName}"]`).classList.add('active');
            document.getElementById(`provider${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`).classList.add('active');
        }
        
        // View provider booking
        function viewProviderBooking(id) {
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const booking = bookings.find(b => b.id === id);
            const currentProvider = JSON.parse(localStorage.getItem('currentProvider') || 'null');
            
            if (booking && currentProvider && booking.providerId === currentProvider.id) {
                let details = '';
                
                if (booking.type === 'doctor') {
                    details = `
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Service Type:</span>
                            <span class="submission-detail-value">Doctor Appointment</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Patient Name:</span>
                            <span class="submission-detail-value">${booking.patientName}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Patient Age:</span>
                            <span class="submission-detail-value">${booking.patientAge}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Patient Gender:</span>
                            <span class="submission-detail-value">${booking.patientGender}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Medical Issue:</span>
                            <span class="submission-detail-value">${booking.medicalIssue}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Preferred Date:</span>
                            <span class="submission-detail-value">${booking.preferredDate}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Preferred Time:</span>
                            <span class="submission-detail-value">${booking.preferredTime}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Contact:</span>
                            <span class="submission-detail-value">${booking.contact}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Notes:</span>
                            <span class="submission-detail-value">${booking.notes || 'None'}</span>
                        </div>
                    `;
                } else {
                    details = `
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Service Type:</span>
                            <span class="submission-detail-value">Draftsman Service</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Client Name:</span>
                            <span class="submission-detail-value">${booking.clientName}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Project Type:</span>
                            <span class="submission-detail-value">${booking.projectType}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Project Details:</span>
                            <span class="submission-detail-value">${booking.projectDetails}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Property Address:</span>
                            <span class="submission-detail-value">${booking.propertyAddress}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Property Size:</span>
                            <span class="submission-detail-value">${booking.propertySize} perches</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Preferred Visit Date:</span>
                            <span class="submission-detail-value">${booking.preferredVisitDate}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Contact:</span>
                            <span class="submission-detail-value">${booking.contact}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Budget:</span>
                            <span class="submission-detail-value">LKR ${booking.budget}</span>
                        </div>
                    `;
                }
                
                details += `
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Status:</span>
                        <span class="submission-detail-value">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Booking Date:</span>
                        <span class="submission-detail-value">${booking.bookingDate}</span>
                    </div>
                `;
                
                document.getElementById('bookingDetailsTitle').textContent = 'Booking Details';
                document.getElementById('bookingDetailsContent').innerHTML = details;
                
                // Show response section if booking is not completed
                const responseSection = document.getElementById('responseSection');
                const existingResponse = document.getElementById('existingResponse');
                const responseFormContainer = document.getElementById('responseFormContainer');
                
                if (booking.status !== 'completed' && booking.status !== 'rejected') {
                    responseSection.style.display = 'block';
                    
                    if (booking.providerResponse) {
                        existingResponse.innerHTML = `
                            <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                                <strong>Your previous response (${booking.responseDate}):</strong>
                                <p>${booking.providerResponse}</p>
                            </div>
                        `;
                        responseFormContainer.style.display = 'block';
                    } else {
                        existingResponse.innerHTML = '';
                        responseFormContainer.style.display = 'block';
                    }
                    
                    // Store current booking ID for response submission
                    responseFormContainer.dataset.bookingId = booking.id;
                } else {
                    responseSection.style.display = 'none';
                }
                
                document.getElementById('bookingDetailsModal').style.display = 'flex';
            }
        }
        
        // Respond to booking
        function respondToBooking(id) {
            viewProviderBooking(id);
        }
        
        // Submit provider response
        function submitProviderResponse() {
            const responseText = document.getElementById('providerResponse').value.trim();
            const bookingId = document.getElementById('responseFormContainer').dataset.bookingId;
            
            if (!responseText) {
                alert('Please enter a response');
                return;
            }
            
            if (!bookingId) {
                alert('Booking ID not found');
                return;
            }
            
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const bookingIndex = bookings.findIndex(b => b.id === parseInt(bookingId));
            
            if (bookingIndex !== -1) {
                bookings[bookingIndex].providerResponse = responseText;
                bookings[bookingIndex].responseDate = new Date().toISOString().split('T')[0];
                bookings[bookingIndex].status = 'confirmed';
                
                localStorage.setItem('bookings', JSON.stringify(bookings));
                
                // Send notification to user (simulated)
                const userEmail = bookings[bookingIndex].userEmail;
                alert(`Response submitted successfully! Notification sent to ${userEmail}`);
                
                // Update provider dashboard
                const currentProvider = JSON.parse(localStorage.getItem('currentProvider') || 'null');
                if (currentProvider) {
                    loadProviderBookings(currentProvider.id);
                    loadUpcomingBookings(currentProvider.id);
                }
                
                // Update user dashboard if they're viewing
                loadUserBookings();
                
                // Close modal
                closeBookingDetailsModal();
            }
        }
        
        // Mark booking as completed
        function markBookingAsCompleted() {
            const bookingId = document.getElementById('responseFormContainer').dataset.bookingId;
            
            if (!bookingId) {
                alert('Booking ID not found');
                return;
            }
            
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const bookingIndex = bookings.findIndex(b => b.id === parseInt(bookingId));
            
            if (bookingIndex !== -1) {
                bookings[bookingIndex].status = 'completed';
                localStorage.setItem('bookings', JSON.stringify(bookings));
                
                alert('Booking marked as completed!');
                
                // Update provider dashboard
                const currentProvider = JSON.parse(localStorage.getItem('currentProvider') || 'null');
                if (currentProvider) {
                    loadProviderBookings(currentProvider.id);
                    loadUpcomingBookings(currentProvider.id);
                }
                
                // Update user dashboard
                loadUserBookings();
                
                // Close modal
                closeBookingDetailsModal();
            }
        }
        
        // Update provider profile
        function updateProviderProfile(event) {
            event.preventDefault();
            
            const currentProvider = JSON.parse(localStorage.getItem('currentProvider') || 'null');
            if (!currentProvider) {
                alert('Please login as a service provider first');
                showLoginModal();
                return;
            }
            
            const name = document.getElementById('updateProviderName').value;
            const phone = document.getElementById('updateProviderPhone').value;
            const address = document.getElementById('updateProviderAddress').value;
            const bio = document.getElementById('updateProviderBio').value;
            
            const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
            const providerIndex = providers.findIndex(p => p.id === currentProvider.id);
            
            if (providerIndex !== -1) {
                providers[providerIndex].name = name;
                providers[providerIndex].phone = phone;
                providers[providerIndex].address = address;
                providers[providerIndex].bio = bio;
                
                if (currentProvider.type === 'doctor') {
                    providers[providerIndex].hospital = document.getElementById('updateDoctorHospital').value;
                    providers[providerIndex].availability = document.getElementById('updateDoctorAvailability').value;
                    providers[providerIndex].consultationFee = document.getElementById('updateDoctorConsultationFee').value;
                } else {
                    providers[providerIndex].services = document.getElementById('updateDraftsmanServices').value;
                    providers[providerIndex].rate = document.getElementById('updateDraftsmanRate').value;
                    providers[providerIndex].availability = document.getElementById('updateDraftsmanAvailability').value;
                }
                
                localStorage.setItem('serviceProviders', JSON.stringify(providers));
                localStorage.setItem('currentProvider', JSON.stringify(providers[providerIndex]));
                
                // Update UI
                document.getElementById('userName').textContent = name;
                loadProviderDashboard(providers[providerIndex]);
                
                alert('Your profile has been updated successfully!');
            }
        }
        
        // Change availability status
        function changeAvailabilityStatus(status) {
            const currentProvider = JSON.parse(localStorage.getItem('currentProvider') || 'null');
            if (!currentProvider) return;
            
            const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
            const providerIndex = providers.findIndex(p => p.id === currentProvider.id);
            
            if (providerIndex !== -1) {
                providers[providerIndex].availabilityStatus = status;
                localStorage.setItem('serviceProviders', JSON.stringify(providers));
                localStorage.setItem('currentProvider', JSON.stringify(providers[providerIndex]));
                
                document.getElementById('currentAvailabilityStatus').textContent = status;
                alert(`Availability status changed to ${status}`);
            }
        }
        
        // Close booking details modal
        function closeBookingDetailsModal() {
            document.getElementById('bookingDetailsModal').style.display = 'none';
        }
        
        // Close response modal
        function closeResponseModal() {
            document.getElementById('responseModal').style.display = 'none';
        }
        
        // Show admin panel
        function showAdminPanel() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            
            if (!currentUser) {
                alert('Please login first to access the admin panel');
                showLoginModal();
                return;
            }
            
            if (currentUser.role !== 'admin') {
                alert('Access denied. Admin privileges required.');
                return;
            }
            
            document.getElementById('homeContent').style.display = 'none';
            document.getElementById('userDashboard').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            document.getElementById('providerDashboard').style.display = 'none';
            updateStats();
            loadUsersTable();
            loadSubmissionsTable();
            loadProvidersTable();
            loadBookingsTable();
            loadNewsTable();
        }
        
        // Handle login form submission
        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const role = document.getElementById('loginRole').value;
            
            if (role === 'user' || role === 'admin') {
                // Login as regular user or admin
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const user = users.find(u => u.email === email && u.password === password && u.role === role);
                
                if (user) {
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    localStorage.removeItem('currentProvider');
                    closeAuthModal();
                    updateUserInterface();
                    
                    if (role === 'admin') {
                        showAdminPanel();
                    } else {
                        showDashboard();
                    }
                    
                    // Clear form fields
                    document.getElementById('loginEmail').value = '';
                    document.getElementById('loginPassword').value = '';
                } else {
                    alert('Invalid email or password for the selected role. Please try again.');
                }
            } else if (role === 'doctor' || role === 'draftsman') {
                // Login as service provider
                const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
                const provider = providers.find(p => p.email === email && p.password === password && p.type === role && p.status === 'approved');
                
                if (provider) {
                    localStorage.setItem('currentProvider', JSON.stringify(provider));
                    localStorage.removeItem('currentUser');
                    closeAuthModal();
                    updateUserInterface();
                    showProviderDashboard();
                    
                    // Clear form fields
                    document.getElementById('loginEmail').value = '';
                    document.getElementById('loginPassword').value = '';
                } else {
                    alert('Invalid credentials or your account is not approved yet. Please contact admin if you have already registered.');
                }
            } else {
                alert('Please select a role to login.');
            }
        }
        
        // Handle signup form submission
        function handleSignup(event) {
            event.preventDefault();
            
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            const profilePictureInput = document.getElementById('profilePicture');
            
            if (password !== confirmPassword) {
                alert('Passwords do not match. Please try again.');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            
            // Check if user already exists
            if (users.some(u => u.email === email)) {
                alert('User with this email already exists. Please login instead.');
                return;
            }
            
            // Create new user
            const newUser = {
                id: users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1,
                name,
                email,
                password,
                role: 'user',
                profilePicture: 'https://ui-avatars.com/api/?name=' + encodeURIComponent(name) + '&background=2e8b57&color=fff',
                joinDate: new Date().toISOString().split('T')[0],
                status: 'Active',
                phone: '',
                address: '',
                district: '',
                pradeshiyaSabha: ''
            };
            
            // Handle profile picture if selected
            if (profilePictureInput.files.length > 0) {
                const file = profilePictureInput.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    newUser.profilePicture = e.target.result;
                    completeSignup(newUser, users);
                };
                reader.readAsDataURL(file);
            } else {
                completeSignup(newUser, users);
            }
        }
        
        // Complete the signup process
        function completeSignup(newUser, users) {
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('currentUser', JSON.stringify(newUser));
            
            closeAuthModal();
            updateUserInterface();
            showDashboard();
            
            // Clear form fields
            document.getElementById('signupName').value = '';
            document.getElementById('signupEmail').value = '';
            document.getElementById('signupPassword').value = '';
            document.getElementById('signupConfirmPassword').value = '';
            document.getElementById('profilePicture').value = '';
            document.getElementById('profilePreview').src = 'https://ui-avatars.com/api/?name=User&background=2e8b57&color=fff';
            
            alert('Account created successfully! Welcome to LifeBridge Rural.');
        }
        
        // Handle provider registration - UPDATED WITH PRADESHIYA SABHA
        function handleProviderRegistration(event) {
            event.preventDefault();
            
            try {
                // Get form values
                const providerType = document.getElementById('providerType').value;
                const name = document.getElementById('providerName').value.trim();
                const email = document.getElementById('providerEmail').value.trim();
                const password = document.getElementById('providerPassword').value;
                const confirmPassword = document.getElementById('providerConfirmPassword').value;
                const phone = document.getElementById('providerPhone').value.trim();
                const address = document.getElementById('providerAddress').value.trim();
                const district = document.getElementById('providerDistrict').value;
                const pradeshiyaSabha = document.getElementById('providerPradeshiyaSabha').value;
                const bio = document.getElementById('providerBio').value.trim();
                const termsChecked = document.getElementById('providerTerms').checked;
                
                console.log('Provider registration attempt:', { providerType, name, email, pradeshiyaSabha });
                
                // Validation
                if (password !== confirmPassword) {
                    alert('Passwords do not match. Please try again.');
                    return false;
                }
                
                if (!name || !email || !password || !phone || !address || !district || !pradeshiyaSabha || !bio) {
                    alert('Please fill all required fields.');
                    return false;
                }
                
                if (!termsChecked) {
                    alert('Please accept the terms and conditions.');
                    return false;
                }
                
                // Provider-specific validation
                if (providerType === 'doctor') {
                    const specialization = document.getElementById('doctorSpecialization').value;
                    const qualification = document.getElementById('doctorQualification').value.trim();
                    const registrationNo = document.getElementById('doctorRegistrationNo').value.trim();
                    const experience = document.getElementById('doctorExperience').value;
                    const hospital = document.getElementById('doctorHospital').value.trim();
                    const availability = document.getElementById('doctorAvailability').value.trim();
                    const consultationFee = document.getElementById('doctorConsultationFee').value;
                    
                    if (!specialization || !qualification || !registrationNo || !experience || 
                        !hospital || !availability || !consultationFee) {
                        alert('Please fill all doctor-specific fields.');
                        return false;
                    }
                } else if (providerType === 'draftsman') {
                    const qualification = document.getElementById('draftsmanQualification').value.trim();
                    const registrationNo = document.getElementById('draftsmanRegistrationNo').value.trim();
                    const experience = document.getElementById('draftsmanExperience').value;
                    const services = document.getElementById('draftsmanServices').value.trim();
                    const rate = document.getElementById('draftsmanRate').value.trim();
                    const availability = document.getElementById('draftsmanAvailability').value.trim();
                    
                    if (!qualification || !registrationNo || !experience || !services || 
                        !rate || !availability) {
                        alert('Please fill all draftsman-specific fields.');
                        return false;
                    }
                }
                
                console.log('All validations passed');
                
                // Check if email already exists
                const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                
                if (providers.some(p => p.email === email) || users.some(u => u.email === email)) {
                    alert('Email already exists. Please use a different email.');
                    return false;
                }
                
                console.log('Email check passed');
                
                // Create provider object
                const newId = providers.length > 0 ? Math.max(...providers.map(p => p.id)) + 1 : 1;
                const newProvider = {
                    id: newId,
                    type: providerType,
                    name,
                    email,
                    password,
                    phone,
                    address,
                    district,
                    pradeshiyaSabha,
                    bio,
                    profilePicture: 'https://ui-avatars.com/api/?name=' + encodeURIComponent(name) + '&background=2e8b57&color=fff',
                    status: 'pending',
                    availabilityStatus: 'available',
                    joinDate: new Date().toISOString().split('T')[0]
                };
                
                // Add provider-specific fields
                if (providerType === 'doctor') {
                    newProvider.specialization = document.getElementById('doctorSpecialization').value;
                    newProvider.qualification = document.getElementById('doctorQualification').value;
                    newProvider.registrationNo = document.getElementById('doctorRegistrationNo').value;
                    newProvider.experience = parseInt(document.getElementById('doctorExperience').value);
                    newProvider.hospital = document.getElementById('doctorHospital').value;
                    newProvider.availability = document.getElementById('doctorAvailability').value;
                    newProvider.consultationFee = parseInt(document.getElementById('doctorConsultationFee').value);
                } else {
                    newProvider.qualification = document.getElementById('draftsmanQualification').value;
                    newProvider.registrationNo = document.getElementById('draftsmanRegistrationNo').value;
                    newProvider.experience = parseInt(document.getElementById('draftsmanExperience').value);
                    newProvider.services = document.getElementById('draftsmanServices').value;
                    newProvider.rate = document.getElementById('draftsmanRate').value;
                    newProvider.availability = document.getElementById('draftsmanAvailability').value;
                }
                
                console.log('Provider object created with pradeshiya sabha:', pradeshiyaSabha);
                
                // Handle profile picture
                const profilePictureInput = document.getElementById('providerProfilePicture');
                if (profilePictureInput.files.length > 0) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        newProvider.profilePicture = e.target.result;
                        completeProviderRegistration(newProvider, providers);
                    };
                    reader.readAsDataURL(profilePictureInput.files[0]);
                } else {
                    completeProviderRegistration(newProvider, providers);
                }
                
                return false;
                
            } catch (error) {
                console.error('Registration error:', error);
                alert('Error during registration: ' + error.message);
                return false;
            }
        }
        
        // Complete provider registration
        function completeProviderRegistration(newProvider, providers) {
            providers.push(newProvider);
            localStorage.setItem('serviceProviders', JSON.stringify(providers));
            
            // Close modal
            document.getElementById('providerRegistrationModal').style.display = 'none';
            
            // Clear form
            document.getElementById('providerRegistrationForm').reset();
            document.getElementById('providerProfilePreview').src = 'https://ui-avatars.com/api/?name=Provider&background=2e8b57&color=fff';
            document.getElementById('providerPradeshiyaSabha').innerHTML = '<option value="">Select Pradeshiya Sabha</option>';
            
            // Show success message
            alert('Registration submitted successfully! Your account will be reviewed by our admin team. You will receive an email notification once approved.');
            
            // Update admin stats if admin is viewing
            if (document.getElementById('adminPanel').style.display === 'block') {
                updateStats();
                loadProvidersTable();
            }
            
            console.log('Provider registered with pradeshiya sabha:', newProvider.pradeshiyaSabha);
        }
        
        // Handle logout
        function handleLogout() {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('currentProvider');
            updateUserInterface();
            showHome();
        }
        
        // Handle provider logout
        function handleProviderLogout() {
            localStorage.removeItem('currentProvider');
            localStorage.removeItem('currentUser');
            updateUserInterface();
            showHome();
        }
        
        // Navigate to category page
        function navigateToCategory(category) {
            const categoryUrls = {
                'government': 'schemes.html',
                'regulations': 'legi.html',
                'health': 'shahnas.html',
                'agriculture': 'naja.html',
                'welfare': 'thiliban.html',
            };
            
            window.open(categoryUrls[category], '_blank');
        }
        
        // Load available providers
        function loadAvailableProviders() {
            const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
            const approvedDoctors = providers.filter(p => p.type === 'doctor' && p.status === 'approved');
            const approvedDraftsmen = providers.filter(p => p.type === 'draftsman' && p.status === 'approved');
            
            // Load doctors for booking form
            const doctorSelect = document.getElementById('bookingDoctor');
            doctorSelect.innerHTML = '<option value="">Select a doctor</option>';
            approvedDoctors.forEach(doctor => {
                const option = document.createElement('option');
                option.value = doctor.id;
                option.textContent = `${doctor.name} - ${getSpecializationName(doctor.specialization)} (${doctor.hospital})`;
                doctorSelect.appendChild(option);
            });
            
            // Load draftsmen for booking form
            const draftsmanSelect = document.getElementById('bookingDraftsman');
            draftsmanSelect.innerHTML = '<option value="">Select a draftsman</option>';
            approvedDraftsmen.forEach(draftsman => {
                const option = document.createElement('option');
                option.value = draftsman.id;
                option.textContent = `${draftsman.name} - ${draftsman.services ? draftsman.services.substring(0, 50) + '...' : 'General Drafting'}`;
                draftsmanSelect.appendChild(option);
            });
        }
        
        // Get specialization name
        function getSpecializationName(code) {
            const specializations = {
                'general': 'General Practitioner',
                'pediatrics': 'Pediatrics',
                'gynecology': 'Gynecology',
                'cardiology': 'Cardiology',
                'dermatology': 'Dermatology',
                'orthopedics': 'Orthopedics',
                'psychiatry': 'Psychiatry',
                'dentistry': 'Dentistry'
            };
            return specializations[code] || code;
        }
        
        // Show available doctors
        function showAvailableDoctors() {
            const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
            const approvedDoctors = providers.filter(p => p.type === 'doctor' && p.status === 'approved');
            
            const doctorsList = document.getElementById('doctorsList');
            doctorsList.innerHTML = '';
            
            if (approvedDoctors.length === 0) {
                doctorsList.innerHTML = '<p>No doctors available at the moment.</p>';
            } else {
                approvedDoctors.forEach(doctor => {
                    const doctorCard = document.createElement('div');
                    doctorCard.className = 'category-card';
                    doctorCard.innerHTML = `
                        <div class="category-icon"><i class="fas fa-user-md"></i></div>
                        <div class="category-content">
                            <h3>${doctor.name}</h3>
                            <p><strong>Specialization:</strong> ${getSpecializationName(doctor.specialization)}</p>
                            <p><strong>Hospital:</strong> ${doctor.hospital}</p>
                            <p><strong>Experience:</strong> ${doctor.experience} years</p>
                            <p><strong>Fee:</strong> LKR ${doctor.consultationFee}</p>
                            <p><strong>Availability:</strong> ${doctor.availability}</p>
                            <button class="read-more-btn" onclick="bookDoctorWithId(${doctor.id})" style="margin-top: 10px;">Book Now</button>
                        </div>
                    `;
                    doctorsList.appendChild(doctorCard);
                });
            }
            
            document.getElementById('availableDoctors').style.display = 'block';
            document.getElementById('availableDraftsmen').style.display = 'none';
            document.getElementById('doctorBookingForm').style.display = 'none';
            document.getElementById('draftsmanBookingForm').style.display = 'none';
        }
        
        // Show available draftsmen
        function showAvailableDraftsmen() {
            const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
            const approvedDraftsmen = providers.filter(p => p.type === 'draftsman' && p.status === 'approved');
            
            const draftsmenList = document.getElementById('draftsmenList');
            draftsmenList.innerHTML = '';
            
            if (approvedDraftsmen.length === 0) {
                draftsmenList.innerHTML = '<p>No draftsmen available at the moment.</p>';
            } else {
                approvedDraftsmen.forEach(draftsman => {
                    const draftsmanCard = document.createElement('div');
                    draftsmanCard.className = 'category-card';
                    draftsmanCard.innerHTML = `
                        <div class="category-icon"><i class="fas fa-ruler-combined"></i></div>
                        <div class="category-content">
                            <h3>${draftsman.name}</h3>
                            <p><strong>Experience:</strong> ${draftsman.experience} years</p>
                            <p><strong>Services:</strong> ${draftsman.services ? draftsman.services.substring(0, 100) + '...' : 'General Drafting'}</p>
                            <p><strong>Rate:</strong> ${draftsman.rate}</p>
                            <p><strong>Availability:</strong> ${draftsman.availability}</p>
                            <button class="read-more-btn" onclick="bookDraftsmanWithId(${draftsman.id})" style="margin-top: 10px;">Book Now</button>
                        </div>
                    `;
                    draftsmenList.appendChild(draftsmanCard);
                });
            }
            
            document.getElementById('availableDoctors').style.display = 'none';
            document.getElementById('availableDraftsmen').style.display = 'block';
            document.getElementById('doctorBookingForm').style.display = 'none';
            document.getElementById('draftsmanBookingForm').style.display = 'none';
        }
        
        // Book doctor
        function bookDoctor() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (!currentUser) {
                alert('Please login to book a doctor');
                showLoginModal();
                return;
            }
            
            document.getElementById('availableDoctors').style.display = 'none';
            document.getElementById('availableDraftsmen').style.display = 'none';
            document.getElementById('doctorBookingForm').style.display = 'block';
            document.getElementById('draftsmanBookingForm').style.display = 'none';
            
            // Set default values from user profile
            document.getElementById('patientName').value = currentUser.name;
            document.getElementById('bookingContact').value = currentUser.phone;
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('preferredDate').min = today;
        }
        
        // Book doctor with specific ID
        function bookDoctorWithId(doctorId) {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (!currentUser) {
                alert('Please login to book a doctor');
                showLoginModal();
                return;
            }
            
            // Set the selected doctor
            document.getElementById('bookingDoctor').value = doctorId;
            bookDoctor();
        }
        
        // Book draftsman
        function bookDraftsman() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (!currentUser) {
                alert('Please login to book a draftsman');
                showLoginModal();
                return;
            }
            
            document.getElementById('availableDoctors').style.display = 'none';
            document.getElementById('availableDraftsmen').style.display = 'none';
            document.getElementById('doctorBookingForm').style.display = 'none';
            document.getElementById('draftsmanBookingForm').style.display = 'block';
            
            // Set default values from user profile
            document.getElementById('clientName').value = currentUser.name;
            document.getElementById('draftsmanContact').value = currentUser.phone;
            document.getElementById('propertyAddress').value = currentUser.address;
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('preferredVisitDate').min = today;
        }
        
        // Book draftsman with specific ID
        function bookDraftsmanWithId(draftsmanId) {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (!currentUser) {
                alert('Please login to book a draftsman');
                showLoginModal();
                return;
            }
            
            // Set the selected draftsman
            document.getElementById('bookingDraftsman').value = draftsmanId;
            bookDraftsman();
        }
        
        // Cancel booking
        function cancelBooking() {
            document.getElementById('availableDoctors').style.display = 'none';
            document.getElementById('availableDraftsmen').style.display = 'none';
            document.getElementById('doctorBookingForm').style.display = 'none';
            document.getElementById('draftsmanBookingForm').style.display = 'none';
        }
        
        // Submit doctor booking
        function submitDoctorBooking(event) {
            event.preventDefault();
            
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (!currentUser) {
                alert('Please login to book a doctor');
                showLoginModal();
                return;
            }
            
            const doctorId = parseInt(document.getElementById('bookingDoctor').value);
            const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
            const doctor = providers.find(p => p.id === doctorId && p.type === 'doctor' && p.status === 'approved');
            
            if (!doctor) {
                alert('Please select a valid doctor');
                return;
            }
            
            const patientName = document.getElementById('patientName').value;
            const patientAge = document.getElementById('patientAge').value;
            const patientGender = document.getElementById('patientGender').value;
            const medicalIssue = document.getElementById('medicalIssue').value;
            const preferredDate = document.getElementById('preferredDate').value;
            const preferredTime = document.getElementById('preferredTime').value;
            const contact = document.getElementById('bookingContact').value;
            const notes = document.getElementById('bookingNotes').value;
            
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const newId = bookings.length > 0 ? Math.max(...bookings.map(b => b.id)) + 1 : 1;
            
            bookings.push({
                id: newId,
                type: 'doctor',
                providerId: doctorId,
                providerName: doctor.name,
                userId: currentUser.id,
                userName: currentUser.name,
                userEmail: currentUser.email,
                patientName,
                patientAge: parseInt(patientAge),
                patientGender,
                medicalIssue,
                preferredDate,
                preferredTime,
                contact,
                notes,
                status: 'pending',
                providerResponse: '',
                responseDate: '',
                bookingDate: new Date().toISOString().split('T')[0]
            });
            
            localStorage.setItem('bookings', JSON.stringify(bookings));
            
            // Clear form
            document.getElementById('doctorBookingFormContent').reset();
            
            alert('Doctor appointment booked successfully! The doctor will respond to your booking soon.');
            
            // Update stats and bookings
            updateStats();
            loadBookingsTable();
            loadUserBookings();
            
            // Hide booking form
            cancelBooking();
        }
        
        // Submit draftsman booking
        function submitDraftsmanBooking(event) {
            event.preventDefault();
            
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (!currentUser) {
                alert('Please login to book a draftsman');
                showLoginModal();
                return;
            }
            
            const draftsmanId = parseInt(document.getElementById('bookingDraftsman').value);
            const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
            const draftsman = providers.find(p => p.id === draftsmanId && p.type === 'draftsman' && p.status === 'approved');
            
            if (!draftsman) {
                alert('Please select a valid draftsman');
                return;
            }
            
            const clientName = document.getElementById('clientName').value;
            const projectType = document.getElementById('projectType').value;
            const projectDetails = document.getElementById('projectDetails').value;
            const propertyAddress = document.getElementById('propertyAddress').value;
            const propertySize = parseFloat(document.getElementById('propertySize').value);
            const preferredVisitDate = document.getElementById('preferredVisitDate').value;
            const contact = document.getElementById('draftsmanContact').value;
            const budget = parseInt(document.getElementById('draftsmanBudget').value);
            
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const newId = bookings.length > 0 ? Math.max(...bookings.map(b => b.id)) + 1 : 1;
            
            bookings.push({
                id: newId,
                type: 'draftsman',
                providerId: draftsmanId,
                providerName: draftsman.name,
                userId: currentUser.id,
                userName: currentUser.name,
                userEmail: currentUser.email,
                clientName,
                projectType,
                projectDetails,
                propertyAddress,
                propertySize,
                preferredVisitDate,
                contact,
                budget,
                status: 'pending',
                providerResponse: '',
                responseDate: '',
                bookingDate: new Date().toISOString().split('T')[0]
            });
            
            localStorage.setItem('bookings', JSON.stringify(bookings));
            
            // Clear form
            document.getElementById('draftsmanBookingFormContent').reset();
            
            alert('Draftsman service booked successfully! The draftsman will respond to your booking soon.');
            
            // Update stats and bookings
            updateStats();
            loadBookingsTable();
            loadUserBookings();
            
            // Hide booking form
            cancelBooking();
        }
        
        // Load providers table for admin
        function loadProvidersTable() {
            const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
            const tableBody = document.getElementById('providersTableBody');
            tableBody.innerHTML = '';
            
            providers.forEach(provider => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${provider.name}</td>
                    <td>${provider.type === 'doctor' ? 'Doctor' : 'Draftsman'}</td>
                    <td>${provider.email}</td>
                    <td>
                        <span class="status-badge ${provider.status === 'approved' ? 'status-approved' : provider.status === 'rejected' ? 'status-rejected' : 'status-pending'}">
                            ${provider.status.charAt(0).toUpperCase() + provider.status.slice(1)}
                        </span>
                    </td>
                    <td>
                        ${provider.status === 'pending' ? `
                            <button class="action-btn approve-btn" onclick="approveProvider(${provider.id})">Approve</button>
                            <button class="action-btn reject-btn" onclick="rejectProvider(${provider.id})">Reject</button>
                        ` : ''}
                        <button class="action-btn view-btn" onclick="viewProvider(${provider.id})">View</button>
                        <button class="action-btn delete-btn" onclick="deleteProvider(${provider.id})">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // Search providers
        function searchProviders() {
            const searchText = document.getElementById('providerSearch').value.toLowerCase();
            const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
            const tableBody = document.getElementById('providersTableBody');
            tableBody.innerHTML = '';
            
            const filteredProviders = providers.filter(provider => 
                provider.name.toLowerCase().includes(searchText) || 
                provider.email.toLowerCase().includes(searchText) ||
                provider.type.toLowerCase().includes(searchText)
            );
            
            filteredProviders.forEach(provider => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${provider.name}</td>
                    <td>${provider.type === 'doctor' ? 'Doctor' : 'Draftsman'}</td>
                    <td>${provider.email}</td>
                    <td>
                        <span class="status-badge ${provider.status === 'approved' ? 'status-approved' : provider.status === 'rejected' ? 'status-rejected' : 'status-pending'}">
                            ${provider.status.charAt(0).toUpperCase() + provider.status.slice(1)}
                        </span>
                    </td>
                    <td>
                        ${provider.status === 'pending' ? `
                            <button class="action-btn approve-btn" onclick="approveProvider(${provider.id})">Approve</button>
                            <button class="action-btn reject-btn" onclick="rejectProvider(${provider.id})">Reject</button>
                        ` : ''}
                        <button class="action-btn view-btn" onclick="viewProvider(${provider.id})">View</button>
                        <button class="action-btn delete-btn" onclick="deleteProvider(${provider.id})">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // View provider details
        function viewProvider(id) {
            const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
            const provider = providers.find(p => p.id === id);
            
            if (provider) {
                let details = '';
                
                if (provider.type === 'doctor') {
                    details = `
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Type:</span>
                            <span class="submission-detail-value">Doctor</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Name:</span>
                            <span class="submission-detail-value">${provider.name}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Email:</span>
                            <span class="submission-detail-value">${provider.email}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Phone:</span>
                            <span class="submission-detail-value">${provider.phone}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Specialization:</span>
                            <span class="submission-detail-value">${getSpecializationName(provider.specialization)}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Qualification:</span>
                            <span class="submission-detail-value">${provider.qualification}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Registration No:</span>
                            <span class="submission-detail-value">${provider.registrationNo}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Experience:</span>
                            <span class="submission-detail-value">${provider.experience} years</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Hospital:</span>
                            <span class="submission-detail-value">${provider.hospital}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Consultation Fee:</span>
                            <span class="submission-detail-value">LKR ${provider.consultationFee}</span>
                        </div>
                    `;
                } else {
                    details = `
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Type:</span>
                            <span class="submission-detail-value">Draftsman</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Name:</span>
                            <span class="submission-detail-value">${provider.name}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Email:</span>
                            <span class="submission-detail-value">${provider.email}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Phone:</span>
                            <span class="submission-detail-value">${provider.phone}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Qualification:</span>
                            <span class="submission-detail-value">${provider.qualification}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Registration No:</span>
                            <span class="submission-detail-value">${provider.registrationNo}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Experience:</span>
                            <span class="submission-detail-value">${provider.experience} years</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Services:</span>
                            <span class="submission-detail-value">${provider.services}</span>
                        </div>
                        <div class="submission-detail-item">
                            <span class="submission-detail-label">Rate:</span>
                            <span class="submission-detail-value">${provider.rate}</span>
                        </div>
                    `;
                }
                
                details += `
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Address:</span>
                        <span class="submission-detail-value">${provider.address}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">District:</span>
                        <span class="submission-detail-value">${provider.district}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Pradeshiya Sabha:</span>
                        <span class="submission-detail-value">${provider.pradeshiyaSabha || 'Not specified'}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Bio:</span>
                        <span class="submission-detail-value">${provider.bio}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Status:</span>
                        <span class="submission-detail-value">${provider.status.charAt(0).toUpperCase() + provider.status.slice(1)}</span>
                    </div>
                    <div class="submission-detail-item">
                        <span class="submission-detail-label">Join Date:</span>
                            <span class="submission-detail-value">${provider.joinDate}</span>
                    </div>
                `;
                
                document.getElementById('bookingDetailsTitle').textContent = 'Provider Details';
                document.getElementById('bookingDetailsContent').innerHTML = details;
                document.getElementById('responseSection').style.display = 'none';
                document.getElementById('bookingDetailsModal').style.display = 'flex';
            }
        }
        
        // Approve provider
        function approveProvider(id) {
            const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
            const providerIndex = providers.findIndex(p => p.id === id);
            
            if (providerIndex !== -1) {
                providers[providerIndex].status = 'approved';
                localStorage.setItem('serviceProviders', JSON.stringify(providers));
                loadProvidersTable();
                updateStats();
                
                // Send approval notification (simulated)
                const providerEmail = providers[providerIndex].email;
                const providerPhone = providers[providerIndex].phone;
                alert(`Provider approved successfully! Notification sent to ${providerEmail} and ${providerPhone}. They can now login to the system.`);
            }
        }
        
        // Reject provider
        function rejectProvider(id) {
            const providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
            const providerIndex = providers.findIndex(p => p.id === id);
            
            if (providerIndex !== -1) {
                providers[providerIndex].status = 'rejected';
                localStorage.setItem('serviceProviders', JSON.stringify(providers));
                loadProvidersTable();
                updateStats();
                
                // Send rejection notification (simulated)
                const providerEmail = providers[providerIndex].email;
                alert(`Provider rejected. Notification sent to ${providerEmail}.`);
            }
        }
        
        // Delete provider
        function deleteProvider(id) {
            if (confirm('Are you sure you want to delete this provider? This action cannot be undone.')) {
                let providers = JSON.parse(localStorage.getItem('serviceProviders') || '[]');
                providers = providers.filter(p => p.id !== id);
                localStorage.setItem('serviceProviders', JSON.stringify(providers));
                loadProvidersTable();
                updateStats();
                alert('Provider deleted successfully!');
            }
        }
        
        // Load bookings table for admin - INCLUDING BUILDINGS.HTML BOOKINGS
        function loadBookingsTable() {
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const tableBody = document.getElementById('bookingsTableBody');
            tableBody.innerHTML = '';
            
            // Sort by date (newest first)
            bookings.sort((a, b) => new Date(b.bookingDate) - new Date(a.bookingDate));
            
            bookings.forEach(booking => {
                const serviceType = booking.type === 'doctor' ? 'Doctor Appointment' : 'Draftsman Service';
                const statusClass = booking.status === 'confirmed' ? 'status-approved' : 
                                   booking.status === 'pending' ? 'status-pending' : 
                                   booking.status === 'completed' ? 'status-completed' : 'status-rejected';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${booking.userName}</td>
                    <td>${booking.providerName}</td>
                    <td>${serviceType}</td>
                    <td>${booking.preferredDate || booking.bookingDate}</td>
                    <td><span class="status-badge ${statusClass}">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span></td>
                    <td>
                        <button class="action-btn view-btn" onclick="viewAdminBooking(${booking.id})">View</button>
                        <button class="action-btn delete-btn" onclick="deleteAdminBooking(${booking.id})">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // View booking for admin
        function viewAdminBooking(id) {
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const booking = bookings.find(b => b.id === id);
            
            if (booking) {
                viewUserBooking(id); // Reuse the same function
            }
        }
        
        // Delete booking for admin
        function deleteAdminBooking(id) {
            if (confirm('Are you sure you want to delete this booking?')) {
                let bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
                bookings = bookings.filter(b => b.id !== id);
                localStorage.setItem('bookings', JSON.stringify(bookings));
                loadBookingsTable();
                updateStats();
                alert('Booking deleted successfully!');
            }
        }
        
        // Search bookings
        function searchBookings() {
            const searchText = document.getElementById('bookingSearch').value.toLowerCase();
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const tableBody = document.getElementById('bookingsTableBody');
            tableBody.innerHTML = '';
            
            const filteredBookings = bookings.filter(booking => 
                booking.userName.toLowerCase().includes(searchText) || 
                booking.providerName.toLowerCase().includes(searchText) ||
                booking.type.toLowerCase().includes(searchText) ||
                booking.status.toLowerCase().includes(searchText)
            );
            
            filteredBookings.forEach(booking => {
                const serviceType = booking.type === 'doctor' ? 'Doctor Appointment' : 'Draftsman Service';
                const statusClass = booking.status === 'confirmed' ? 'status-approved' : 
                                   booking.status === 'pending' ? 'status-pending' : 
                                   booking.status === 'completed' ? 'status-completed' : 'status-rejected';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${booking.userName}</td>
                    <td>${booking.providerName}</td>
                    <td>${serviceType}</td>
                    <td>${booking.preferredDate || booking.bookingDate}</td>
                    <td><span class="status-badge ${statusClass}">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span></td>
                    <td>
                        <button class="action-btn view-btn" onclick="viewAdminBooking(${booking.id})">View</button>
                        <button class="action-btn delete-btn" onclick="deleteAdminBooking(${booking.id})">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // News Functions
        function setupNewsFilters() {
            const filterButtons = document.querySelectorAll('.news-filter-btn');
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');
                    // Display news for selected category
                    displayNews(this.getAttribute('data-category'));
                });
            });
        }
        
        function displayNews(category) {
            const newsGrid = document.getElementById('newsGrid');
            const news = JSON.parse(localStorage.getItem('news') || '[]');
            
            // Clear the grid
            newsGrid.innerHTML = '';
            
            // Filter news by category if not 'all'
            const filteredNews = category === 'all' 
                ? news 
                : news.filter(item => item.category === category);
            
            if (filteredNews.length === 0) {
                newsGrid.innerHTML = `
                    <div class="no-news">
                        <i class="fas fa-newspaper" style="font-size: 3rem; color: #ccc; margin-bottom: 15px;"></i>
                        <h3>No news available</h3>
                        <p>There are no news items in this category yet.</p>
                    </div>
                `;
                return;
            }
            
            // Display news items
            filteredNews.forEach(item => {
                const categoryNames = {
                    'government': 'Government Schemes',
                    'regulations': 'Regulations',
                    'health': 'Health & Safety',
                    'agriculture': 'Agriculture',
                    'welfare': 'Social Welfare'
                };
                
                const newsCard = document.createElement('div');
                newsCard.className = 'news-card';
                newsCard.innerHTML = `
                    <div class="news-image">
                        <img src="${item.image || 'https://images.unsplash.com/photo-1588681664899-f142ff2dc9b1?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80'}" alt="${item.title}">
                    </div>
                    <div class="news-content">
                        <span class="news-category">${categoryNames[item.category]}</span>
                        <h3 class="news-title">${item.title}</h3>
                        <p class="news-excerpt">${item.content.substring(0, 100)}...</p>
                        <button class="read-more-btn" onclick="viewFullNews(${item.id})">Read More</button>
                        <div class="news-date">${item.date}</div>
                    </div>
                `;
                newsGrid.appendChild(newsCard);
            });
        }
        
        function viewFullNews(id) {
            const news = JSON.parse(localStorage.getItem('news') || '[]');
            const newsItem = news.find(n => n.id === id);
            
            if (newsItem) {
                const categoryNames = {
                    'government': 'Government Schemes',
                    'regulations': 'Regulations',
                    'health': 'Health & Safety',
                    'agriculture': 'Agriculture',
                    'welfare': 'Social Welfare'
                };
                
                // Create a modal to display the full news
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0, 0, 0, 0.7);
                    z-index: 1000;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                `;
                
                modal.innerHTML = `
                    <div class="modal-content" style="
                        background-color: white;
                        border-radius: 10px;
                        width: 90%;
                        max-width: 700px;
                        max-height: 90vh;
                        overflow-y: auto;
                        padding: 30px;
                        position: relative;
                    ">
                        <button class="close-btn" onclick="this.parentElement.parentElement.remove()" style="
                            position: absolute;
                            top: 10px;
                            right: 10px;
                            background: none;
                            border: none;
                            font-size: 24px;
                            cursor: pointer;
                        ">&times;</button>
                        
                        <h2 style="color: #2e8b57; margin-bottom: 15px;">${newsItem.title}</h2>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                            <span class="news-category">${categoryNames[newsItem.category]}</span>
                            <span class="news-date">${newsItem.date}</span>
                        </div>
                        
                        ${newsItem.image ? `<img src="${newsItem.image}" alt="${newsItem.title}" style="width: 100%; max-height: 300px; object-fit: cover; border-radius: 8px; margin-bottom: 20px;">` : ''}
                        
                        <div style="line-height: 1.6;">
                            ${newsItem.content.split('\n').map(paragraph => `<p style="margin-bottom: 15px;">${paragraph}</p>`).join('')}
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Close modal when clicking outside
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            }
        }
        
        function addNewsItem(event) {
            event.preventDefault();
            
            const title = document.getElementById('newsTitle').value;
            const category = document.getElementById('newsCategory').value;
            const content = document.getElementById('newsContent').value;
            const image = document.getElementById('newsImage').value;
            
            const news = JSON.parse(localStorage.getItem('news') || '[]');
            const newId = news.length > 0 ? Math.max(...news.map(n => n.id)) + 1 : 1;
            
            // Add new item at the beginning of the array
            news.unshift({
                id: newId,
                title,
                category,
                content,
                image: image || 'https://images.unsplash.com/photo-1588681664899-f142ff2dc9b1?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80',
                date: new Date().toISOString().split('T')[0],
                author: 'Admin'
            });
            
            localStorage.setItem('news', JSON.stringify(news));
            
            // Clear form
            document.getElementById('newsForm').reset();
            
            // Update news table and stats
            loadNewsTable();
            updateStats();
            
            alert('News item added successfully!');
        }
        
        function loadNewsTable() {
            const news = JSON.parse(localStorage.getItem('news') || '[]');
            const tableBody = document.getElementById('newsTableBody');
            tableBody.innerHTML = '';
            
            const categoryNames = {
                'government': 'Government Schemes',
                'regulations': 'Regulations',
                'health': 'Health & Safety',
                'agriculture': 'Agriculture',
                'welfare': 'Social Welfare'
            };
            
            news.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.title}</td>
                    <td>${categoryNames[item.category]}</td>
                    <td>${item.date}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editNews(${item.id})">Edit</button>
                        <button class="action-btn delete-btn" onclick="deleteNews(${item.id})">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function searchNews() {
            const searchText = document.getElementById('newsSearch').value.toLowerCase();
            const news = JSON.parse(localStorage.getItem('news') || '[]');
            const tableBody = document.getElementById('newsTableBody');
            tableBody.innerHTML = '';
            
            const filteredNews = news.filter(item => 
                item.title.toLowerCase().includes(searchText) || 
                item.content.toLowerCase().includes(searchText)
            );
            
            const categoryNames = {
                'government': 'Government Schemes',
                'regulations': 'Regulations',
                'health': 'Health & Safety',
                'agriculture': 'Agriculture',
                'welfare': 'Social Welfare'
            };
            
            filteredNews.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.title}</td>
                    <td>${categoryNames[item.category]}</td>
                    <td>${item.date}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editNews(${item.id})">Edit</button>
                        <button class="action-btn delete-btn" onclick="deleteNews(${item.id})">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function editNews(id) {
            const news = JSON.parse(localStorage.getItem('news') || '[]');
            const newsItem = news.find(n => n.id === id);
            
            if (newsItem) {
                const newTitle = prompt('Enter new title:', newsItem.title);
                if (newTitle !== null) {
                    newsItem.title = newTitle;
                    localStorage.setItem('news', JSON.stringify(news));
                    loadNewsTable();
                    alert('News item updated successfully!');
                }
            }
        }
        
        function deleteNews(id) {
            if (confirm('Are you sure you want to delete this news item?')) {
                let news = JSON.parse(localStorage.getItem('news') || '[]');
                news = news.filter(n => n.id !== id);
                localStorage.setItem('news', JSON.stringify(news));
                loadNewsTable();
                updateStats();
                alert('News item deleted successfully!');
            }
        }
        
        // Initialize the application
        window.onload = function() {
            initializeData();
        };
    </script>
</body>
</html>
